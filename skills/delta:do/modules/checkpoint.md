# æ£€æŸ¥ç‚¹æœºåˆ¶ (Checkpoint System)

## æ¦‚è¿°

æ£€æŸ¥ç‚¹æœºåˆ¶å…è®¸é•¿ä»»åŠ¡åœ¨ä¸­æ–­åæ¢å¤æ‰§è¡Œï¼Œé¿å…é‡å¤å·¥ä½œã€‚æ¯ä¸ªå…³é”®èŠ‚ç‚¹è‡ªåŠ¨ä¿å­˜çŠ¶æ€ï¼Œæ”¯æŒå¤šç§æ¢å¤æ¨¡å¼ã€‚

---

## æ£€æŸ¥ç‚¹æ•°æ®ç»“æ„

### ä¸»æ£€æŸ¥ç‚¹æ–‡ä»¶

ä½ç½®: `.skillpack/current/checkpoint.json`

```json
{
  "version": "3.0.0",
  "task_id": "uuid-v4",
  "task_description": "åŸå§‹ä»»åŠ¡æè¿°",
  "route": "RALPH",
  "complexity_score": 58,
  "scoring_breakdown": {
    "scope": 18,
    "dependency": 12,
    "technical": 15,
    "risk": 6,
    "time": 4,
    "ui": 3
  },
  "phases": {
    "total": 4,
    "current": 3,
    "completed": [1, 2],
    "status": {
      "1": "completed",
      "2": "completed",
      "3": "in_progress",
      "4": "pending"
    }
  },
  "subtasks": {
    "total": 5,
    "completed": ["subtask_1", "subtask_2"],
    "in_progress": "subtask_3",
    "pending": ["subtask_4", "subtask_5"]
  },
  "files": {
    "modified": [
      {"path": "src/auth.ts", "action": "modified", "checksum": "abc123"},
      {"path": "src/types.ts", "action": "created", "checksum": "def456"}
    ],
    "outputs": [
      ".skillpack/current/1_analysis.md",
      ".skillpack/current/2_plan.md"
    ]
  },
  "context": {
    "knowledge_query_result": "...",
    "important_decisions": []
  },
  "timestamps": {
    "created": "2024-01-18T10:00:00Z",
    "updated": "2024-01-18T10:30:00Z",
    "last_activity": "2024-01-18T10:30:00Z"
  },
  "recovery": {
    "can_resume": true,
    "resume_point": "phase_3_subtask_3",
    "notes": "å­ä»»åŠ¡3æ‰§è¡Œåˆ°ç¬¬2æ­¥"
  }
}
```

---

## æ£€æŸ¥ç‚¹ä¿å­˜æ—¶æœº

### è‡ªåŠ¨ä¿å­˜

| äº‹ä»¶ | ä¿å­˜å†…å®¹ | ä¼˜å…ˆçº§ |
|------|----------|--------|
| é˜¶æ®µå®Œæˆ | å®Œæ•´çŠ¶æ€ + è¾“å‡ºæ–‡ä»¶ | é«˜ |
| å­ä»»åŠ¡å®Œæˆ | å­ä»»åŠ¡çŠ¶æ€ + æ–‡ä»¶å˜æ›´ | é«˜ |
| æ–‡ä»¶å†™å…¥å | æ–‡ä»¶æ ¡éªŒå’Œ | ä¸­ |
| æ¯ 5 åˆ†é’Ÿ | å¢é‡çŠ¶æ€ | ä½ |
| é”™è¯¯å‘ç”Ÿå‰ | é”™è¯¯å‰çŠ¶æ€ | é«˜ |

### æ‰‹åŠ¨ä¿å­˜

ç”¨æˆ·å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼æ‰‹åŠ¨ä¿å­˜ï¼š
- è¾“å…¥ `save` æˆ– `checkpoint`
- ä½¿ç”¨å¿«æ·é”®ï¼ˆå¦‚æ”¯æŒï¼‰

---

## ä¿å­˜æµç¨‹

### Step 1: æ”¶é›†å½“å‰çŠ¶æ€

```
1. è¯»å– Todo åˆ—è¡¨çŠ¶æ€
2. æ”¶é›†å·²ä¿®æ”¹æ–‡ä»¶åˆ—è¡¨
3. è®¡ç®—æ–‡ä»¶æ ¡éªŒå’Œ
4. è®°å½•å½“å‰æ‰§è¡Œä½ç½®
```

### Step 2: ç”Ÿæˆæ£€æŸ¥ç‚¹

```
1. åˆ›å»ºæ£€æŸ¥ç‚¹ JSON
2. å¤‡ä»½å‰ä¸€ä¸ªæ£€æŸ¥ç‚¹ï¼ˆå¦‚å­˜åœ¨ï¼‰
3. å†™å…¥æ–°æ£€æŸ¥ç‚¹
4. éªŒè¯å†™å…¥å®Œæ•´æ€§
```

### Step 3: è¾“å‡ºç¡®è®¤

```
ğŸ’¾ æ£€æŸ¥ç‚¹å·²ä¿å­˜
ä½ç½®: .skillpack/current/checkpoint.json
é˜¶æ®µ: Phase {N}/{TOTAL}
å­ä»»åŠ¡: {completed}/{total}
æ—¶é—´: {timestamp}
```

---

## æ¢å¤å‘½ä»¤

### åŸºæœ¬æ¢å¤

```bash
/do --resume
```

ä»æœ€è¿‘çš„æ£€æŸ¥ç‚¹æ¢å¤ï¼Œè‡ªåŠ¨æ£€æµ‹ï¼š
1. è¯»å– `.skillpack/current/checkpoint.json`
2. éªŒè¯æ–‡ä»¶å®Œæ•´æ€§
3. æ¢å¤æ‰§è¡Œä¸Šä¸‹æ–‡
4. ä»ä¸­æ–­ç‚¹ç»§ç»­

### æŒ‡å®šä»»åŠ¡æ¢å¤

```bash
/do --resume <task_id>
```

ä»å†å²æ£€æŸ¥ç‚¹æ¢å¤ï¼š
1. åœ¨ `.skillpack/history/` ä¸­æŸ¥æ‰¾æŒ‡å®š task_id
2. æ¢å¤åˆ° current ç›®å½•
3. ç»§ç»­æ‰§è¡Œ

### æŸ¥çœ‹å¯æ¢å¤ä»»åŠ¡

```bash
/do --list-checkpoints
```

è¾“å‡ºï¼š
```
ğŸ“‹ å¯æ¢å¤çš„ä»»åŠ¡:

[1] task-uuid-1234 (æœ€è¿‘)
    ä»»åŠ¡: "add user authentication"
    çŠ¶æ€: Phase 2/3, 60% å®Œæˆ
    æ›´æ–°: 2024-01-18 10:30:00

[2] task-uuid-5678
    ä»»åŠ¡: "build complete CMS"
    çŠ¶æ€: Phase 3/4, å­ä»»åŠ¡ 2/5
    æ›´æ–°: 2024-01-17 15:45:00

ä½¿ç”¨ /do --resume <task_id> æ¢å¤
```

---

## æ¢å¤æµç¨‹

### Step 1: éªŒè¯æ£€æŸ¥ç‚¹

```
1. æ£€æŸ¥æ£€æŸ¥ç‚¹æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. éªŒè¯ JSON æ ¼å¼
3. æ£€æŸ¥ç‰ˆæœ¬å…¼å®¹æ€§
4. éªŒè¯æ–‡ä»¶æ ¡éªŒå’Œ
```

### Step 2: æ¢å¤ä¸Šä¸‹æ–‡

```
1. åŠ è½½ä»»åŠ¡æè¿°å’Œè·¯ç”±å†³ç­–
2. æ¢å¤è¯„åˆ†ä¿¡æ¯
3. åŠ è½½çŸ¥è¯†åº“æŸ¥è¯¢ç»“æœ
4. æ¢å¤ Todo åˆ—è¡¨
```

### Step 3: å®šä½æ¢å¤ç‚¹

```
1. ç¡®å®šå½“å‰é˜¶æ®µ
2. ç¡®å®šå½“å‰å­ä»»åŠ¡ï¼ˆå¦‚é€‚ç”¨ï¼‰
3. ç¡®å®šå­ä»»åŠ¡å†…çš„æ­¥éª¤
```

### Step 4: ç»§ç»­æ‰§è¡Œ

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”„ ä»æ£€æŸ¥ç‚¹æ¢å¤
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ä»»åŠ¡: {task_description}
æ¢å¤ç‚¹: Phase {N}, {è¯¦ç»†ä½ç½®}
å·²å®Œæˆ: {completed_percentage}%
ç»§ç»­æ‰§è¡Œ...
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

---

## æ£€æŸ¥ç‚¹å®Œæ•´æ€§éªŒè¯

### æ–‡ä»¶æ ¡éªŒ

```json
{
  "files": {
    "modified": [
      {
        "path": "src/auth.ts",
        "checksum": "sha256:abc123...",
        "size": 1234,
        "mtime": "2024-01-18T10:30:00Z"
      }
    ]
  }
}
```

### éªŒè¯å¤±è´¥å¤„ç†

| æƒ…å†µ | å¤„ç†æ–¹å¼ |
|------|----------|
| æ–‡ä»¶è¢«åˆ é™¤ | è­¦å‘Šï¼Œè¯¢é—®æ˜¯å¦é‡æ–°åˆ›å»º |
| æ–‡ä»¶è¢«ä¿®æ”¹ | è­¦å‘Šï¼Œæ˜¾ç¤ºå·®å¼‚ï¼Œè¯¢é—®ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬ |
| æ£€æŸ¥ç‚¹æŸå | å°è¯•ä»å¤‡ä»½æ¢å¤ |
| ç‰ˆæœ¬ä¸å…¼å®¹ | æç¤ºå‡çº§æˆ–ä»å¤´å¼€å§‹ |

---

## å¤‡ä»½ç­–ç•¥

### è‡ªåŠ¨å¤‡ä»½

æ¯æ¬¡ä¿å­˜æ–°æ£€æŸ¥ç‚¹æ—¶ï¼š
1. å°†å‰ä¸€ä¸ªæ£€æŸ¥ç‚¹ç§»åŠ¨åˆ° `.skillpack/current/checkpoint.backup.json`
2. æœ€å¤šä¿ç•™ 1 ä¸ªå¤‡ä»½

### å†å²å½’æ¡£

ä»»åŠ¡å®Œæˆæ—¶ï¼š
1. åˆ›å»ºæ—¶é—´æˆ³ç›®å½• `.skillpack/history/<timestamp>/`
2. ç§»åŠ¨æ‰€æœ‰è¾“å‡ºæ–‡ä»¶
3. ä¿ç•™æ£€æŸ¥ç‚¹ï¼ˆç”¨äºå®¡è®¡ï¼‰

---

## è¾“å‡ºç›®å½•ç»“æ„

```
.skillpack/
â”œâ”€â”€ current/
â”‚   â”œâ”€â”€ checkpoint.json           # å½“å‰æ£€æŸ¥ç‚¹
â”‚   â”œâ”€â”€ checkpoint.backup.json    # å¤‡ä»½æ£€æŸ¥ç‚¹
â”‚   â”œâ”€â”€ 1_analysis.md             # é˜¶æ®µè¾“å‡º
â”‚   â”œâ”€â”€ 2_plan.md
â”‚   â”œâ”€â”€ 3_subtask_1.md
â”‚   â””â”€â”€ error.log                 # é”™è¯¯æ—¥å¿—
â”‚
â””â”€â”€ history/
    â”œâ”€â”€ 2024-01-18_103000/        # å®Œæˆçš„ä»»åŠ¡
    â”‚   â”œâ”€â”€ checkpoint.json
    â”‚   â”œâ”€â”€ 1_analysis.md
    â”‚   â””â”€â”€ ...
    â””â”€â”€ 2024-01-17_154500/
        â””â”€â”€ ...
```

---

## é…ç½®é€‰é¡¹

åœ¨ `.skillpackrc` ä¸­é…ç½®ï¼š

```json
{
  "checkpoint": {
    "auto_save": true,
    "save_interval_minutes": 5,
    "max_history": 10,
    "verify_on_resume": true,
    "backup_count": 1
  }
}
```

| é€‰é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `auto_save` | true | å¯ç”¨è‡ªåŠ¨ä¿å­˜ |
| `save_interval_minutes` | 5 | è‡ªåŠ¨ä¿å­˜é—´éš” |
| `max_history` | 10 | ä¿ç•™çš„å†å²ä»»åŠ¡æ•° |
| `verify_on_resume` | true | æ¢å¤æ—¶éªŒè¯æ–‡ä»¶ |
| `backup_count` | 1 | ä¿ç•™çš„å¤‡ä»½æ•°é‡ |

---

## æ¸…ç†å‘½ä»¤

### æ¸…ç†å½“å‰ä»»åŠ¡

```bash
/do --clear
```

åˆ é™¤ `.skillpack/current/` ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼ˆä¿ç•™ç›®å½•ï¼‰ã€‚

### æ¸…ç†å†å²

```bash
/do --clean-history [--keep N]
```

æ¸…ç†æ—§çš„å†å²è®°å½•ï¼Œä¿ç•™æœ€è¿‘ N ä¸ªï¼ˆé»˜è®¤ 5ï¼‰ã€‚
