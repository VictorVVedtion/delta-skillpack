# æ£€æŸ¥ç‚¹æœºåˆ¶ (Checkpoint System) v3.0

## æ¦‚è¿°

æ£€æŸ¥ç‚¹æœºåˆ¶å…è®¸é•¿ä»»åŠ¡åœ¨ä¸­æ–­åæ¢å¤æ‰§è¡Œï¼Œé¿å…é‡å¤å·¥ä½œã€‚v3.0 ç‰ˆæœ¬å¼•å…¥**å¼‚æ­¥å¹¶è¡Œæ‰§è¡Œ**æ”¯æŒï¼Œå…è®¸åŒæ—¶è¿½è¸ªå¤šä¸ªæ­£åœ¨æ‰§è¡Œçš„åå°ä»»åŠ¡ã€‚

---

## æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ | ç‰ˆæœ¬ | é»˜è®¤ |
|------|------|------|------|
| **åŸå­å†™å…¥** | write-rename æ¨¡å¼ï¼Œé˜²æ­¢å†™å…¥ä¸­æ–­å¯¼è‡´æ•°æ®æŸå | v2.0 | å¯ç”¨ |
| **SHA-256 æ ¡éªŒå’Œ** | éªŒè¯æ£€æŸ¥ç‚¹å®Œæ•´æ€§ | v2.0 | å¯ç”¨ |
| **å¤šç‰ˆæœ¬å¤‡ä»½** | ä¿ç•™å¤šä¸ªå†å²å¤‡ä»½ | v2.0 | 3 ä¸ª |
| **è‡ªåŠ¨æ¢å¤** | æ ¡éªŒå¤±è´¥æ—¶è‡ªåŠ¨ä»å¤‡ä»½æ¢å¤ | v2.0 | å¯ç”¨ |
| **å¹¶è¡Œä»»åŠ¡è¿½è¸ª** | åŒæ—¶è¿½è¸ªå¤šä¸ªåå°ä»»åŠ¡ (run_in_background) | **v3.0** | å¯ç”¨ |
| **ä»»åŠ¡ä¾èµ–å›¾ (DAG)** | å®šä¹‰å­ä»»åŠ¡é—´ä¾èµ–å…³ç³» | **v3.0** | å¯é€‰ |
| **æ³¢æ¬¡æ‰§è¡Œ** | æŒ‰ä¾èµ–åˆ†ç»„å¹¶è¡Œæ‰§è¡Œ | **v3.0** | å¯ç”¨ |

---

## v3.0 æ–°ç‰¹æ€§

### å¹¶è¡Œä»»åŠ¡æ”¯æŒ

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **å¤šä»»åŠ¡ in_progress** | `subtasks.in_progress` ä»å•ä¸€å­—ç¬¦ä¸²å‡çº§ä¸ºå¤šä»»åŠ¡å¯¹è±¡ |
| **åå°ä»»åŠ¡ ID æ˜ å°„** | è®°å½• task_id ä¸ subtask çš„å¯¹åº”å…³ç³» |
| **æ³¢æ¬¡ç®¡ç†** | æŒ‰ä¾èµ–å…³ç³»åˆ†ç»„ï¼ŒåŒä¸€æ³¢æ¬¡å†…å¹¶è¡Œæ‰§è¡Œ |
| **è·¨æ¨¡å‹å¹¶è¡Œ** | æ”¯æŒ Codex + Gemini åŒæ—¶æ‰§è¡Œ |

---

## æ£€æŸ¥ç‚¹æ•°æ®ç»“æ„

### ä¸»æ£€æŸ¥ç‚¹æ–‡ä»¶

ä½ç½®: `.skillpack/current/checkpoint.json`

```json
{
  "version": "3.0",
  "task_id": "uuid-v4",
  "task_description": "åŸå§‹ä»»åŠ¡æè¿°",
  "route": "RALPH",
  "complexity_score": 58,
  "scoring_breakdown": {
    "scope": 18,
    "dependency": 12,
    "technical": 15,
    "risk": 6,
    "time": 4,
    "ui": 3
  },
  "execution": {
    "current_phase": 3,
    "total_phases": 4,
    "phases": [
      {
        "number": 1,
        "name": "æ·±åº¦åˆ†æ",
        "status": "completed",
        "model": "claude",
        "started_at": "2026-01-18T10:00:00Z",
        "completed_at": "2026-01-18T10:15:00Z",
        "output_file": "1_analysis.md",
        "metrics": {
          "duration_ms": 900000,
          "tokens_used": 8500
        }
      }
    ]
  },
  "subtasks": {
    "total": 5,
    "completed": ["subtask_1", "subtask_2"],
    "in_progress": {
      "subtask_3": {
        "task_id": "bg-uuid-001",
        "model": "codex",
        "started_at": "2026-01-18T10:30:00Z",
        "status": "running"
      },
      "subtask_4": {
        "task_id": "bg-uuid-002",
        "model": "codex",
        "started_at": "2026-01-18T10:30:05Z",
        "status": "running"
      }
    },
    "pending": ["subtask_5"]
  },
  "parallel_execution": {
    "enabled": true,
    "current_wave": 2,
    "total_waves": 3,
    "max_concurrent": 3,
    "dag": {
      "nodes": [
        {"id": "subtask_1", "dependencies": []},
        {"id": "subtask_2", "dependencies": []},
        {"id": "subtask_3", "dependencies": ["subtask_1"]},
        {"id": "subtask_4", "dependencies": ["subtask_1"]},
        {"id": "subtask_5", "dependencies": ["subtask_3", "subtask_4"]}
      ],
      "waves": [
        ["subtask_1", "subtask_2"],
        ["subtask_3", "subtask_4"],
        ["subtask_5"]
      ]
    }
  },
  "files": {
    "created": ["src/auth.ts"],
    "modified": [
      {"path": "src/types.ts", "checksum": "sha256:abc123", "size": 1234}
    ],
    "outputs": [
      ".skillpack/current/1_analysis.md",
      ".skillpack/current/2_plan.md"
    ]
  },
  "context": {
    "knowledge_query_result": "...",
    "important_decisions": []
  },
  "recovery": {
    "can_resume": true,
    "resume_point": "phase_3_subtask_3",
    "notes": "å­ä»»åŠ¡3æ‰§è¡Œåˆ°ç¬¬2æ­¥",
    "error_log": []
  },
  "timestamps": {
    "created": "2026-01-18T10:00:00Z",
    "updated": "2026-01-18T10:30:00Z"
  },
  "checksum": "sha256:æ•´ä¸ªæ–‡ä»¶å†…å®¹çš„æ ¡éªŒå’Œ(ä¸å«æ­¤å­—æ®µ)"
}
```

### æ ¡éªŒå’Œæ–‡ä»¶

ä½ç½®: `.skillpack/current/checkpoint.json.sha256`

```
sha256:e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
```

---

## åŸå­å†™å…¥æœºåˆ¶

### å†™å…¥æµç¨‹

```
ä¿å­˜æ£€æŸ¥ç‚¹
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: ç”Ÿæˆä¸´æ—¶æ–‡ä»¶                         â”‚
â”‚   æ–‡ä»¶å: checkpoint.json.tmp.{random_id}   â”‚
â”‚   ä½ç½®: .skillpack/current/                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: å†™å…¥å®Œæ•´æ•°æ®                         â”‚
â”‚   - åºåˆ—åŒ– JSON                             â”‚
â”‚   - è®¡ç®— SHA-256 (ä¸å« checksum å­—æ®µ)        â”‚
â”‚   - å†™å…¥ checksum å­—æ®µ                       â”‚
â”‚   - fsync ç¡®ä¿å†™å…¥ç£ç›˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: åŸå­é‡å‘½å                           â”‚
â”‚   mv checkpoint.json.tmp.{id}               â”‚
â”‚      â†’ checkpoint.json                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: æ›´æ–°æ ¡éªŒå’Œæ–‡ä»¶                       â”‚
â”‚   å†™å…¥ checkpoint.json.sha256               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: è½®è½¬å¤‡ä»½                             â”‚
â”‚   .backup.3 â†’ åˆ é™¤                          â”‚
â”‚   .backup.2 â†’ .backup.3                     â”‚
â”‚   .backup.1 â†’ .backup.2                     â”‚
â”‚   æ—§ checkpoint.json â†’ .backup.1            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: æ¸…ç†ä¸´æ—¶æ–‡ä»¶                         â”‚
â”‚   åˆ é™¤æ‰€æœ‰ .tmp.* æ–‡ä»¶                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å†™å…¥å¤±è´¥å¤„ç†

| å¤±è´¥é˜¶æ®µ | å½±å“ | å¤„ç† |
|----------|------|------|
| Step 1-2 | æ—  | ä¸´æ—¶æ–‡ä»¶è‡ªåŠ¨æ¸…ç† |
| Step 3 | æ—  | åŸæ–‡ä»¶ä¿æŒä¸å˜ |
| Step 4-6 | è½»å¾® | ä¸‹æ¬¡ä¿å­˜æ—¶ä¿®å¤ |

---

## SHA-256 æ ¡éªŒå’ŒéªŒè¯

### æ ¡éªŒå’Œç”Ÿæˆ

```python
def generate_checksum(checkpoint_data: dict) -> str:
    """ç”Ÿæˆæ£€æŸ¥ç‚¹æ ¡éªŒå’Œ"""
    # ç§»é™¤ checksum å­—æ®µé¿å…é€’å½’
    data_copy = checkpoint_data.copy()
    data_copy.pop('checksum', None)

    # åºåˆ—åŒ–ä¸ºç¡®å®šæ€§ JSON
    json_str = json.dumps(data_copy, sort_keys=True, ensure_ascii=False)

    # è®¡ç®— SHA-256
    return f"sha256:{hashlib.sha256(json_str.encode()).hexdigest()}"
```

### æ ¡éªŒæµç¨‹

```
è¯»å–æ£€æŸ¥ç‚¹
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: è¯»å– checkpoint.json                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: æå– checksum å­—æ®µ                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: é‡æ–°è®¡ç®—æ ¡éªŒå’Œ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: æ¯”å¯¹æ ¡éªŒå’Œ                           â”‚
â”‚   è®¡ç®—å€¼ == å­˜å‚¨å€¼ ?                         â”‚
â”‚   â”œâ”€â”€ æ˜¯ â†’ éªŒè¯é€šè¿‡ï¼ŒåŠ è½½æ•°æ®                â”‚
â”‚   â””â”€â”€ å¦ â†’ è§¦å‘æ¢å¤æµç¨‹                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¡éªŒå¤±è´¥æ¢å¤

```
æ ¡éªŒå¤±è´¥
    â”‚
    â–¼
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš ï¸ æ£€æŸ¥ç‚¹æ ¡éªŒå¤±è´¥
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
æ–‡ä»¶: checkpoint.json
æœŸæœ›: sha256:abc123...
å®é™…: sha256:def456...
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ”„ å°è¯•ä»å¤‡ä»½æ¢å¤...
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¾æ¬¡å°è¯•å¤‡ä»½æ–‡ä»¶:                            â”‚
â”‚   1. checkpoint.json.backup.1               â”‚
â”‚   2. checkpoint.json.backup.2               â”‚
â”‚   3. checkpoint.json.backup.3               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€â”€ æ‰¾åˆ°æœ‰æ•ˆå¤‡ä»½ â†’ æ¢å¤å¹¶æç¤ºç”¨æˆ·
    â”‚
    â””â”€â”€ æ‰€æœ‰å¤‡ä»½æ— æ•ˆ â†’ æŠ¥å‘ŠæŸåï¼Œæä¾›é€‰é¡¹
            â”‚
            â–¼
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘ âŒ æ£€æŸ¥ç‚¹æ•°æ®æŸå                                          â•‘
        â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
        â•‘ æ‰€æœ‰å¤‡ä»½æ–‡ä»¶å‡æ— æ•ˆ                                         â•‘
        â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
        â•‘ ğŸ“‹ é€‰é¡¹:                                                   â•‘
        â•‘   [1] ğŸ”„ ä»å†å²è®°å½•æ¢å¤                                    â•‘
        â•‘   [2] ğŸ†• æ”¾å¼ƒæ£€æŸ¥ç‚¹ï¼Œé‡æ–°å¼€å§‹                              â•‘
        â•‘   [3] ğŸ“ æ‰‹åŠ¨æ£€æŸ¥æ–‡ä»¶                                      â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## å¤šç‰ˆæœ¬å¤‡ä»½ç­–ç•¥

### æ–‡ä»¶ç»“æ„

```
.skillpack/current/
â”œâ”€â”€ checkpoint.json           # å½“å‰æ£€æŸ¥ç‚¹
â”œâ”€â”€ checkpoint.json.sha256    # æ ¡éªŒå’Œæ–‡ä»¶
â”œâ”€â”€ checkpoint.json.backup.1  # æœ€è¿‘å¤‡ä»½ (1 æ¬¡ä¿å­˜å‰)
â”œâ”€â”€ checkpoint.json.backup.2  # è¾ƒæ—©å¤‡ä»½ (2 æ¬¡ä¿å­˜å‰)
â””â”€â”€ checkpoint.json.backup.3  # æœ€æ—©å¤‡ä»½ (3 æ¬¡ä¿å­˜å‰)
```

### è½®è½¬ç­–ç•¥

```
æ–°ä¿å­˜è§¦å‘æ—¶:
  .backup.3 â†’ åˆ é™¤
  .backup.2 â†’ .backup.3
  .backup.1 â†’ .backup.2
  checkpoint.json â†’ .backup.1
  æ–°æ•°æ® â†’ checkpoint.json
```

### é…ç½®

```json
{
  "checkpoint": {
    "backup_count": 3,
    "backup_on_phase_complete": true,
    "backup_on_error": true
  }
}
```

---

## æ£€æŸ¥ç‚¹ä¿å­˜æ—¶æœº

### è‡ªåŠ¨ä¿å­˜

| äº‹ä»¶ | ä¿å­˜å†…å®¹ | ä¼˜å…ˆçº§ | è§¦å‘å¤‡ä»½ |
|------|----------|--------|----------|
| é˜¶æ®µå®Œæˆ | å®Œæ•´çŠ¶æ€ + è¾“å‡ºæ–‡ä»¶ | é«˜ | âœ… |
| å­ä»»åŠ¡å®Œæˆ | å­ä»»åŠ¡çŠ¶æ€ + æ–‡ä»¶å˜æ›´ | é«˜ | âœ… |
| æ–‡ä»¶å†™å…¥å | æ–‡ä»¶æ ¡éªŒå’Œ | ä¸­ | âŒ |
| æ¯ 5 åˆ†é’Ÿ | å¢é‡çŠ¶æ€ | ä½ | âŒ |
| é”™è¯¯å‘ç”Ÿå‰ | é”™è¯¯å‰çŠ¶æ€ | é«˜ | âœ… |
| MCP è°ƒç”¨å‰ | å½“å‰çŠ¶æ€ | ä¸­ | âŒ |

### æ‰‹åŠ¨ä¿å­˜

ç”¨æˆ·å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼æ‰‹åŠ¨ä¿å­˜ï¼š
- è¾“å…¥ `save` æˆ– `checkpoint`
- ä½¿ç”¨å¿«æ·é”®ï¼ˆå¦‚æ”¯æŒï¼‰

---

## æ¢å¤å‘½ä»¤

### åŸºæœ¬æ¢å¤

```bash
/do --resume
```

ä»æœ€è¿‘çš„æ£€æŸ¥ç‚¹æ¢å¤ï¼š
1. è¯»å– `.skillpack/current/checkpoint.json`
2. **éªŒè¯ SHA-256 æ ¡éªŒå’Œ**
3. æ ¡éªŒå¤±è´¥æ—¶å°è¯•ä»å¤‡ä»½æ¢å¤
4. æ¢å¤æ‰§è¡Œä¸Šä¸‹æ–‡
5. ä»ä¸­æ–­ç‚¹ç»§ç»­

### æŒ‡å®šä»»åŠ¡æ¢å¤

```bash
/do --resume <task_id>
```

ä»å†å²æ£€æŸ¥ç‚¹æ¢å¤ï¼š
1. åœ¨ `.skillpack/history/` ä¸­æŸ¥æ‰¾æŒ‡å®š task_id
2. æ¢å¤åˆ° current ç›®å½•
3. ç»§ç»­æ‰§è¡Œ

### æŸ¥çœ‹å¯æ¢å¤ä»»åŠ¡

```bash
/do --list-checkpoints
```

è¾“å‡ºï¼š
```
ğŸ“‹ å¯æ¢å¤çš„ä»»åŠ¡:

[1] task-uuid-1234 (æœ€è¿‘) âœ… æ ¡éªŒé€šè¿‡
    ä»»åŠ¡: "add user authentication"
    çŠ¶æ€: Phase 2/3, 60% å®Œæˆ
    æ›´æ–°: 2026-01-18 10:30:00

[2] task-uuid-5678 âš ï¸ éœ€è¦ä»å¤‡ä»½æ¢å¤
    ä»»åŠ¡: "build complete CMS"
    çŠ¶æ€: Phase 3/4, å­ä»»åŠ¡ 2/5
    æ›´æ–°: 2026-01-17 15:45:00

ä½¿ç”¨ /do --resume <task_id> æ¢å¤
```

---

## æ¢å¤æµç¨‹

### Step 1: éªŒè¯æ£€æŸ¥ç‚¹

```
1. æ£€æŸ¥æ£€æŸ¥ç‚¹æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. éªŒè¯ JSON æ ¼å¼
3. **éªŒè¯ SHA-256 æ ¡éªŒå’Œ**
4. æ ¡éªŒå¤±è´¥æ—¶å°è¯•å¤‡ä»½æ¢å¤
5. æ£€æŸ¥ç‰ˆæœ¬å…¼å®¹æ€§
```

### Step 2: æ¢å¤ä¸Šä¸‹æ–‡

```
1. åŠ è½½ä»»åŠ¡æè¿°å’Œè·¯ç”±å†³ç­–
2. æ¢å¤è¯„åˆ†ä¿¡æ¯
3. åŠ è½½çŸ¥è¯†åº“æŸ¥è¯¢ç»“æœ
4. æ¢å¤ Todo åˆ—è¡¨
```

### Step 3: å®šä½æ¢å¤ç‚¹

```
1. ç¡®å®šå½“å‰é˜¶æ®µ
2. ç¡®å®šå½“å‰å­ä»»åŠ¡ï¼ˆå¦‚é€‚ç”¨ï¼‰
3. ç¡®å®šå­ä»»åŠ¡å†…çš„æ­¥éª¤
```

### Step 4: ç»§ç»­æ‰§è¡Œ

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”„ ä»æ£€æŸ¥ç‚¹æ¢å¤
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ä»»åŠ¡: {task_description}
æ¢å¤ç‚¹: Phase {N}, {è¯¦ç»†ä½ç½®}
å·²å®Œæˆ: {completed_percentage}%
æ ¡éªŒçŠ¶æ€: âœ… é€šè¿‡ | âš ï¸ ä»å¤‡ä»½æ¢å¤
ç»§ç»­æ‰§è¡Œ...
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

---

## è¾“å‡ºç›®å½•ç»“æ„

```
.skillpack/
â”œâ”€â”€ current/
â”‚   â”œâ”€â”€ checkpoint.json           # å½“å‰æ£€æŸ¥ç‚¹
â”‚   â”œâ”€â”€ checkpoint.json.sha256    # æ ¡éªŒå’Œæ–‡ä»¶
â”‚   â”œâ”€â”€ checkpoint.json.backup.1  # å¤‡ä»½ 1
â”‚   â”œâ”€â”€ checkpoint.json.backup.2  # å¤‡ä»½ 2
â”‚   â”œâ”€â”€ checkpoint.json.backup.3  # å¤‡ä»½ 3
â”‚   â”œâ”€â”€ 1_analysis.md             # é˜¶æ®µè¾“å‡º
â”‚   â”œâ”€â”€ 2_plan.md
â”‚   â”œâ”€â”€ execution.log.jsonl       # æ‰§è¡Œæ—¥å¿—
â”‚   â””â”€â”€ error.log                 # é”™è¯¯æ—¥å¿—
â”‚
â””â”€â”€ history/
    â”œâ”€â”€ 2026-01-18_103000_RALPH_æ·»åŠ è®¤è¯/
    â”‚   â”œâ”€â”€ checkpoint.json
    â”‚   â”œâ”€â”€ manifest.json
    â”‚   â””â”€â”€ ...
    â””â”€â”€ 2026-01-17_154500_PLANNED_ä¿®å¤bug/
        â””â”€â”€ ...
```

---

## é…ç½®é€‰é¡¹

åœ¨ `.skillpackrc` ä¸­é…ç½®ï¼š

```json
{
  "checkpoint": {
    "auto_save": true,
    "atomic_writes": true,
    "save_interval_minutes": 5,
    "max_history": 10,
    "verify_on_resume": true,
    "backup_count": 3
  }
}
```

| é€‰é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `auto_save` | true | å¯ç”¨è‡ªåŠ¨ä¿å­˜ |
| `atomic_writes` | true | ä½¿ç”¨åŸå­å†™å…¥ (v2.0) |
| `save_interval_minutes` | 5 | è‡ªåŠ¨ä¿å­˜é—´éš” |
| `max_history` | 10 | ä¿ç•™çš„å†å²ä»»åŠ¡æ•° |
| `verify_on_resume` | true | æ¢å¤æ—¶éªŒè¯æ ¡éªŒå’Œ |
| `backup_count` | 3 | ä¿ç•™çš„å¤‡ä»½æ•°é‡ (v2.0) |

---

## æ¸…ç†å‘½ä»¤

### æ¸…ç†å½“å‰ä»»åŠ¡

```bash
/do --clear
```

åˆ é™¤ `.skillpack/current/` ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼ˆä¿ç•™ç›®å½•ï¼‰ã€‚

### æ¸…ç†å†å²

```bash
/do --clean-history [--keep N]
```

æ¸…ç†æ—§çš„å†å²è®°å½•ï¼Œä¿ç•™æœ€è¿‘ N ä¸ªï¼ˆé»˜è®¤ 5ï¼‰ã€‚

---

## ç‰ˆæœ¬è¿ç§»

### v2.0 â†’ v3.0

è‡ªåŠ¨è¿ç§»æµç¨‹ï¼š
1. æ£€æµ‹åˆ° v2.0 æ£€æŸ¥ç‚¹
2. å°† `subtasks.in_progress` ä»å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯¹è±¡
3. æ·»åŠ  `parallel_execution` é…ç½®å—ï¼ˆé»˜è®¤ç¦ç”¨ï¼‰
4. ä¿ç•™åŸæœ‰æ•°æ®å®Œæ•´æ€§
5. ä¿å­˜å¹¶é€šçŸ¥ç”¨æˆ·

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”„ æ£€æŸ¥ç‚¹ç‰ˆæœ¬å‡çº§
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
å½“å‰ç‰ˆæœ¬: 2.0 â†’ ç›®æ ‡ç‰ˆæœ¬: 3.0
æ–°å¢ç‰¹æ€§: å¹¶è¡Œä»»åŠ¡è¿½è¸ªã€ä»»åŠ¡ä¾èµ–å›¾ã€æ³¢æ¬¡æ‰§è¡Œ
çŠ¶æ€: âœ… è¿ç§»æˆåŠŸ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

**è¿ç§»ç¤ºä¾‹ï¼š**

```json
// v2.0 æ ¼å¼
{
  "subtasks": {
    "in_progress": "subtask_3"
  }
}

// è‡ªåŠ¨è½¬æ¢ä¸º v3.0 æ ¼å¼
{
  "subtasks": {
    "in_progress": {
      "subtask_3": {
        "task_id": null,
        "model": "codex",
        "started_at": "2026-01-18T10:30:00Z",
        "status": "running"
      }
    }
  },
  "parallel_execution": {
    "enabled": false
  }
}
```

### v1.0 â†’ v2.0

è‡ªåŠ¨è¿ç§»æµç¨‹ï¼š
1. æ£€æµ‹åˆ°æ—§ç‰ˆæœ¬æ£€æŸ¥ç‚¹
2. æ·»åŠ  checksum å­—æ®µ
3. åˆ›å»º .sha256 æ–‡ä»¶
4. è½¬æ¢ä¸ºæ–° Schema æ ¼å¼
5. ä¿å­˜å¹¶é€šçŸ¥ç”¨æˆ·

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”„ æ£€æŸ¥ç‚¹ç‰ˆæœ¬å‡çº§
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
å½“å‰ç‰ˆæœ¬: 1.0 â†’ ç›®æ ‡ç‰ˆæœ¬: 2.0
æ–°å¢ç‰¹æ€§: åŸå­å†™å…¥ã€SHA-256 æ ¡éªŒå’Œã€å¤šç‰ˆæœ¬å¤‡ä»½
çŠ¶æ€: âœ… è¿ç§»æˆåŠŸ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

---

## å¹¶è¡Œæ‰§è¡Œæ£€æŸ¥ç‚¹ (v3.0)

### å¹¶è¡Œä»»åŠ¡çŠ¶æ€è¿½è¸ª

å½“ä½¿ç”¨ `run_in_background: true` å¯åŠ¨ä»»åŠ¡æ—¶ï¼Œæ£€æŸ¥ç‚¹è®°å½•æ¯ä¸ªåå°ä»»åŠ¡ï¼š

```json
{
  "subtasks": {
    "in_progress": {
      "subtask_1": {
        "task_id": "bg-uuid-001",
        "model": "codex",
        "started_at": "2026-01-18T10:30:00Z",
        "status": "running",
        "output_file": ".skillpack/current/bg-uuid-001.out"
      },
      "subtask_2": {
        "task_id": "bg-uuid-002",
        "model": "gemini",
        "started_at": "2026-01-18T10:30:05Z",
        "status": "running",
        "output_file": ".skillpack/current/bg-uuid-002.out"
      }
    }
  }
}
```

### ä»»åŠ¡çŠ¶æ€æµè½¬

```
pending â†’ in_progress (running) â†’ completed
                â†“
           in_progress (failed) â†’ retry / skip
```

### æ³¢æ¬¡æ‰§è¡Œç¤ºä¾‹

```
Wave 1: [subtask_1, subtask_2] â†’ å¹¶è¡Œå¯åŠ¨ï¼Œç­‰å¾…å…¨éƒ¨å®Œæˆ
             â†“
Wave 2: [subtask_3, subtask_4] â†’ subtask_3 ä¾èµ– subtask_1 å®Œæˆ
             â†“
Wave 3: [subtask_5]            â†’ ä¾èµ– Wave 2 å…¨éƒ¨å®Œæˆ
```

### å¹¶è¡Œæ‰§è¡Œçš„æ£€æŸ¥ç‚¹ä¿å­˜æ—¶æœº

| äº‹ä»¶ | ä¿å­˜å†…å®¹ | ä¼˜å…ˆçº§ |
|------|----------|--------|
| æ³¢æ¬¡å¼€å§‹ | å¯åŠ¨çš„æ‰€æœ‰ä»»åŠ¡ task_id | é«˜ |
| å•ä»»åŠ¡å®Œæˆ | æ›´æ–°è¯¥ä»»åŠ¡çŠ¶æ€ä¸º completed | é«˜ |
| å•ä»»åŠ¡å¤±è´¥ | è®°å½•é”™è¯¯ï¼Œæ›´æ–°çŠ¶æ€ä¸º failed | é«˜ |
| æ³¢æ¬¡å®Œæˆ | æ¸…ç©º in_progressï¼Œç§»å…¥ completed | é«˜ |
| è½®è¯¢é—´éš™ | å¢é‡æ›´æ–°ä»»åŠ¡çŠ¶æ€ | ä¸­ |

### å¹¶è¡Œä¸­æ–­æ¢å¤

æ¢å¤æ—¶æ£€æµ‹ `parallel_execution.enabled = true`ï¼š

```
æ£€æµ‹åˆ°å¹¶è¡Œæ‰§è¡Œæ£€æŸ¥ç‚¹
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ£€æŸ¥ in_progress ä¸­çš„ä»»åŠ¡çŠ¶æ€               â”‚
â”‚ - task_id å­˜åœ¨ â†’ å°è¯•è¯»å– TaskOutput        â”‚
â”‚ - task_id ä¸ºç©º â†’ æ ‡è®°ä¸ºéœ€è¦é‡æ–°å¯åŠ¨         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¢å¤ç­–ç•¥:                                   â”‚
â”‚ 1. å·²å®Œæˆä»»åŠ¡ â†’ æ ‡è®° completed              â”‚
â”‚ 2. ä»åœ¨è¿è¡Œ â†’ ç»§ç»­è½®è¯¢                      â”‚
â”‚ 3. å¤±è´¥/ä¸¢å¤± â†’ è¯¢é—®æ˜¯å¦é‡æ–°å¯åŠ¨             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### DAG ä¾èµ–å›¾é…ç½®

```json
{
  "parallel_execution": {
    "dag": {
      "nodes": [
        {
          "id": "subtask_1",
          "dependencies": [],
          "model": "codex",
          "estimated_duration_ms": 60000
        },
        {
          "id": "subtask_2",
          "dependencies": [],
          "model": "gemini",
          "estimated_duration_ms": 45000
        },
        {
          "id": "subtask_3",
          "dependencies": ["subtask_1"],
          "model": "codex",
          "estimated_duration_ms": 90000
        }
      ],
      "waves": [
        ["subtask_1", "subtask_2"],
        ["subtask_3"]
      ]
    }
  }
}
```

### ä¸²è¡Œæ¨¡å¼å…¼å®¹

å½“ `parallel_execution.enabled = false` æ—¶ï¼Œè¡Œä¸ºä¸ v2.0 å®Œå…¨ä¸€è‡´ï¼š
- `in_progress` æœ€å¤šåŒ…å«ä¸€ä¸ªä»»åŠ¡
- ä¸ä½¿ç”¨ DAG ä¾èµ–å›¾
- ä¸è¿›è¡Œæ³¢æ¬¡åˆ†ç»„
