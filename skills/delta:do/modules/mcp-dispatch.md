# MCP è°ƒåº¦æ¨¡å— v5.2.1

## æ¦‚è¿°

æœ¬æ¨¡å—å®šä¹‰äº†å¤šæ¨¡å‹åä½œçš„å¼ºåˆ¶è°ƒç”¨è§„åˆ™ï¼Œç¡®ä¿æ­£ç¡®çš„æ¨¡å‹è¢«ç”¨äºæ­£ç¡®çš„é˜¶æ®µã€‚v5.2 æ–°å¢ **å¼‚æ­¥å¹¶è¡Œè°ƒåº¦**ï¼Œv5.2.1 å¼ºåŒ– **CLI ä¼˜å…ˆæ¨¡å¼**ï¼Œå½»åº•è§£å†³ MCP ä¸­æ–­é—®é¢˜ã€‚

---

## âš¡ æ‰§è¡Œæ¨¡å¼å†³ç­–ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰

åœ¨ä»»ä½•æ¨¡å‹è°ƒç”¨ä¹‹å‰ï¼Œ**å¿…é¡»**å…ˆæ£€æŸ¥æ‰§è¡Œæ¨¡å¼ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ‰§è¡Œæ¨¡å¼å†³ç­–æ ‘                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ è¯»å– .skillpackrc     â”‚
              â”‚ cli.prefer_cli_over_mcpâ”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼                              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   true      â”‚                â”‚   false     â”‚
    â”‚ CLI ä¼˜å…ˆ    â”‚                â”‚ MCP æ¨¡å¼    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                              â”‚
           â–¼                              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ä½¿ç”¨ Bash ç›´æ¥è°ƒç”¨   â”‚       â”‚ ä½¿ç”¨ MCP å·¥å…·è°ƒç”¨    â”‚
    â”‚ codex exec / gemini â”‚       â”‚ mcp__codex-cli__*   â”‚
    â”‚ âš ï¸ ç¦æ­¢ MCP è°ƒç”¨     â”‚       â”‚ mcp__gemini-cli__*  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CLI ä¼˜å…ˆæ¨¡å¼ï¼ˆæ¨èï¼‰

**å½“ `cli.prefer_cli_over_mcp: true` æ—¶ï¼Œæ‰€æœ‰å¤–éƒ¨æ¨¡å‹è°ƒç”¨å¿…é¡»ä½¿ç”¨ CLIï¼š**

| åŸ MCP è°ƒç”¨ | CLI æ›¿ä»£å‘½ä»¤ |
|-------------|--------------|
| `mcp__codex-cli__codex` | `codex exec "<prompt>" -s workspace-write` |
| `mcp__gemini-cli__ask-gemini` | `gemini "<prompt>"` |

**ä¼˜åŠ¿ï¼š**
- âœ… å½»åº•é¿å… MCP stdio é€šé“ä¸­æ–­
- âœ… æ— ç¼“å†²åŒºæº¢å‡ºé£é™©
- âœ… è¶…æ—¶æ—¶é—´å¯é…ç½®ï¼ˆé»˜è®¤ 600sï¼‰
- âœ… è¿›ç¨‹ç›´æ¥ç®¡ç†ï¼Œæ›´ç¨³å®š

**CLI è°ƒç”¨ç¤ºä¾‹ï¼š**

```bash
# Codex CLIï¼ˆä»£æ›¿ mcp__codex-cli__codexï¼‰
codex exec "ä»»åŠ¡: å®ç°ç”¨æˆ·ç™»å½•æ¥å£

ç›¸å…³æ–‡ä»¶:
- src/auth/login.ts
- src/models/user.ts

è¦æ±‚:
1. éªŒè¯ç”¨æˆ·å‡­æ®
2. ç”Ÿæˆ JWT token
3. å¤„ç†é”™è¯¯æƒ…å†µ" -s workspace-write

# Gemini CLIï¼ˆä»£æ›¿ mcp__gemini-cli__ask-geminiï¼‰
gemini "@src/components åˆ†æ UI ç»„ä»¶ç»“æ„ï¼Œè®¾è®¡ç™»å½•è¡¨å•"
```

### MCP æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰

å½“ `cli.prefer_cli_over_mcp: false` æ—¶ï¼Œç»§ç»­ä½¿ç”¨ MCP åè®®è°ƒç”¨ã€‚

---

## ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | ç‰¹æ€§ |
|------|------|
| **v5.2.1** | CLI ä¼˜å…ˆæ¨¡å¼å¼ºåŒ–ï¼Œæ‰§è¡Œæ¨¡å¼å†³ç­–æ ‘ï¼Œå½»åº•è§£å†³ MCP ä¸­æ–­ |
| v5.2 | å¼‚æ­¥å¹¶è¡Œè°ƒåº¦ã€æ³¢æ¬¡ç®¡ç†ã€è·¨æ¨¡å‹å¹¶è¡Œã€TaskOutput è½®è¯¢ |
| v5.1 | CLI ç›´æ¥è°ƒç”¨åå¤‡æœºåˆ¶ |
| v5.0 | ä»»åŠ¡ç²’åº¦æ§åˆ¶ã€æ™ºèƒ½é™çº§ç­–ç•¥ |

---

## v5.2 æ–°ç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **å¹¶è¡Œ MCP è°ƒç”¨** | åŒæ—¶å¯åŠ¨å¤šä¸ª MCP ä»»åŠ¡ï¼Œä½¿ç”¨ `run_in_background: true` |
| **æ³¢æ¬¡ç¼–æ’** | æŒ‰ä¾èµ–å…³ç³»åˆ†ç»„ï¼ŒåŒä¸€æ³¢æ¬¡å†…å¹¶è¡Œæ‰§è¡Œ |
| **è·¨æ¨¡å‹å¹¶è¡Œ** | Codex + Gemini åŒæ—¶å·¥ä½œ |
| **ç»Ÿä¸€ç»“æœæ”¶é›†** | TaskOutput è½®è¯¢æ”¶é›†æ‰€æœ‰åå°ä»»åŠ¡ç»“æœ |

## v5.1 ç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **CLI ç›´æ¥è°ƒç”¨** | `--cli` æ ‡å¿—ç»•è¿‡ MCPï¼Œç›´æ¥é€šè¿‡ Bash è°ƒç”¨ |
| **è‡ªåŠ¨ CLI é™çº§** | MCP è¶…æ—¶åè‡ªåŠ¨åˆ‡æ¢åˆ° CLI ç›´æ¥è°ƒç”¨ |
| **ä¸‰å±‚é˜²å¾¡ç­–ç•¥** | ä»»åŠ¡ç²’åº¦æ‹†åˆ† â†’ MCP é‡è¯• â†’ CLI é™çº§ |

---

## æ¨¡å‹åˆ†é…çŸ©é˜µ

### æ¨¡å‹èƒ½åŠ›å®šä½

| æ¨¡å‹ | æ ‡è¯†ç¬¦ | MCP å·¥å…· | æ ¸å¿ƒä¼˜åŠ¿ |
|------|--------|----------|----------|
| **Claude Opus 4.5** | `CLAUDE` | ç›´æ¥æ‰§è¡Œ | ç²¾ç»†æ§åˆ¶ã€è§„åˆ’åè°ƒ |
| **Codex GPT-5.2** | `CODEX` | `mcp__codex-cli__codex` | å¤æ‚å¼€å‘ã€xhigh æ¨ç† |
| **Gemini 3 Pro** | `GEMINI` | `mcp__gemini-cli__ask-gemini` | è¶…é•¿ä¸Šä¸‹æ–‡ã€å¤šæ¨¡æ€ |

### è·¯ç”±-é˜¶æ®µ-æ¨¡å‹åˆ†é…è¡¨

#### DIRECT (0-20åˆ†)
```yaml
phases:
  - phase: 1
    name: "æ‰§è¡Œ"
    model: CLAUDE
    tool: null
    reason: "ç®€å•ä»»åŠ¡ç›´æ¥æ‰§è¡Œ"
```

#### PLANNED (21-45åˆ†)
```yaml
phases:
  - phase: 1
    name: "è§„åˆ’"
    model: CLAUDE
    tool: null
    reason: "ä»»åŠ¡åˆ†æå’Œåè°ƒ"
  - phase: 2
    name: "å®ç°"
    model: CODEX
    tool: mcp__codex-cli__codex
    mandatory: true
    reason: "å¤æ‚åŠŸèƒ½å¼€å‘"
  - phase: 3
    name: "å®¡æŸ¥"
    model: CODEX
    tool: mcp__codex-cli__codex
    mandatory: true
    reason: "ä¸“ä¸šä»£ç å®¡æŸ¥"
```

#### RALPH (46-70åˆ†)
```yaml
phases:
  - phase: 1
    name: "æ·±åº¦åˆ†æ"
    model: CLAUDE
    tool: null
    reason: "ä»»åŠ¡åˆ†è§£å’Œä¾èµ–è¯†åˆ«"
  - phase: 2
    name: "è§„åˆ’"
    model: CLAUDE
    tool: null
    reason: "å­ä»»åŠ¡è§„åˆ’"
  - phase: 3
    name: "æ‰§è¡Œå­ä»»åŠ¡"
    model: CODEX
    tool: mcp__codex-cli__codex
    mandatory: true
    reason: "æ‰¹é‡åŠŸèƒ½å¼€å‘"
  - phase: 4
    name: "ç»¼åˆå®¡æŸ¥"
    model: CODEX
    tool: mcp__codex-cli__codex
    mandatory: true
    reason: "ç»¼åˆå®¡æŸ¥"
```

#### ARCHITECT (71-100åˆ†)
```yaml
phases:
  - phase: 1
    name: "æ¶æ„åˆ†æ"
    model: GEMINI
    tool: mcp__gemini-cli__ask-gemini
    mandatory: true
    reason: "æ•´ä¸ªé¡¹ç›®åˆ†æï¼Œè¶…é•¿ä¸Šä¸‹æ–‡"
  - phase: 2
    name: "æ¶æ„è®¾è®¡"
    model: CLAUDE
    tool: null
    reason: "ç²¾ç»†è®¾è®¡å†³ç­–"
  - phase: 3
    name: "å®æ–½è§„åˆ’"
    model: CLAUDE
    tool: null
    reason: "è¯¦ç»†ä»»åŠ¡åˆ†è§£"
  - phase: 4
    name: "åˆ†é˜¶æ®µå®æ–½"
    model: CODEX
    tool: mcp__codex-cli__codex
    mandatory: true
    reason: "æ‰¹é‡å¼€å‘"
  - phase: 5
    name: "éªŒæ”¶å®¡æŸ¥"
    model: CODEX
    tool: mcp__codex-cli__codex
    mandatory: true
    reason: "æ·±åº¦å®¡æŸ¥"
```

#### UI_FLOW
```yaml
phases:
  - phase: 1
    name: "UIè®¾è®¡"
    model: GEMINI
    tool: mcp__gemini-cli__ask-gemini
    mandatory: true
    reason: "å¤šæ¨¡æ€ï¼Œçœ‹å›¾å†™ç "
  - phase: 2
    name: "å®ç°"
    model: GEMINI
    tool: mcp__gemini-cli__ask-gemini
    mandatory: true
    reason: "UIç»„ä»¶å¼€å‘"
  - phase: 3
    name: "é¢„è§ˆéªŒè¯"
    model: CLAUDE
    tool: null
    reason: "éªŒè¯å’Œå¾®è°ƒ"
```

---

## å¼ºåˆ¶è°ƒç”¨è§„åˆ™

### æ ¸å¿ƒçº¦æŸ

1. **ç¦æ­¢æ›¿ä»£**ï¼šå½“ `mandatory: true` æ—¶ï¼Œ**ç¦æ­¢ Claude è‡ªå·±æ‰§è¡Œ**è¯¥é˜¶æ®µçš„æ ¸å¿ƒä»»åŠ¡
2. **å¿…é¡»è°ƒç”¨**ï¼šè¿›å…¥ mandatory é˜¶æ®µæ—¶ï¼Œå¿…é¡»ç«‹å³è°ƒç”¨æŒ‡å®šçš„ MCP å·¥å…·
3. **ç¦æ­¢è·³è¿‡**ï¼šä¸èƒ½å› ä¸ºä»»ä½•åŸå› è·³è¿‡ MCP è°ƒç”¨

### è°ƒç”¨å‰æ£€æŸ¥æ¸…å•

```
[ ] ç¡®è®¤å½“å‰é˜¶æ®µçš„åˆ†é…æ¨¡å‹
[ ] å¦‚æœ mandatory=trueï¼Œå‡†å¤‡ MCP è°ƒç”¨å‚æ•°
[ ] è¾“å‡ºè°ƒç”¨æç¤ºï¼ˆè§ä¸‹æ–¹æ ¼å¼ï¼‰
[ ] æ‰§è¡Œ MCP è°ƒç”¨
[ ] éªŒè¯è¿”å›ç»“æœ
```

### é˜¶æ®µå…¥å£è¾“å‡ºæ ¼å¼

**Claude æ‰§è¡Œé˜¶æ®µï¼š**
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ Phase {N}/{TOTAL}: {é˜¶æ®µåç§°} | {è·¯ç”±} è·¯ç”±
ğŸ¤– æ‰§è¡Œæ¨¡å‹: Claude (ç›´æ¥æ‰§è¡Œ)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**MCP è°ƒç”¨é˜¶æ®µï¼š**
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ Phase {N}/{TOTAL}: {é˜¶æ®µåç§°} | {è·¯ç”±} è·¯ç”±
ğŸ¤– æ‰§è¡Œæ¨¡å‹: {Codex/Gemini} (MCP å¼ºåˆ¶è°ƒç”¨)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”§ MCP å·¥å…·: {tool_name}
ğŸ“ è°ƒç”¨å‚æ•°: {prompt æ‘˜è¦}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

---

## MCP è°ƒç”¨æ¨¡æ¿

### Codex å¼€å‘è°ƒç”¨

```python
# å‚æ•°å‡†å¤‡
prompt = f"""
ä»»åŠ¡: {task_description}

ç›¸å…³æ–‡ä»¶:
{list_of_relevant_files}

è¦æ±‚:
{detailed_requirements}

è¾“å‡ºæ ¼å¼:
- åˆ›å»º/ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨
- æ¯ä¸ªæ–‡ä»¶çš„å®Œæ•´ä»£ç 
- æ‰§è¡Œè¯´æ˜
"""

# è°ƒç”¨
mcp__codex-cli__codex(
    prompt=prompt,
    sandbox="workspace-write"
)
```

### Codex å®¡æŸ¥è°ƒç”¨

```python
prompt = f"""
å®¡æŸ¥ä»»åŠ¡: {task_description}

å˜æ›´æ–‡ä»¶:
{files_changed}

å®¡æŸ¥é‡ç‚¹:
- éœ€æ±‚è¦†ç›–æ£€æŸ¥
- ä»£ç è´¨é‡
- æ½œåœ¨ Bug
- å®‰å…¨é—®é¢˜
"""

mcp__codex-cli__codex(
    prompt=prompt
)
```

### Gemini æ¶æ„åˆ†æè°ƒç”¨

```python
prompt = f"""
@{project_root_path}

åˆ†ææ•´ä¸ªé¡¹ç›®æ¶æ„:
1. æ¨¡å—ä¾èµ–å…³ç³»
2. æŠ€æœ¯æ ˆè¯†åˆ«
3. æ¶æ„æ¨¡å¼è¯†åˆ«
4. æ”¹è¿›å»ºè®®

ç‰¹åˆ«å…³æ³¨: {focus_areas}
"""

mcp__gemini-cli__ask-gemini(
    prompt=prompt
)
```

### Gemini UI å¼€å‘è°ƒç”¨

```python
prompt = f"""
@{components_path}

ä»»åŠ¡: {ui_task_description}

ç°æœ‰ç»„ä»¶:
{existing_components}

è®¾è®¡è¦æ±‚:
{design_requirements}

æŠ€æœ¯æ ˆ: {tech_stack}
"""

mcp__gemini-cli__ask-gemini(
    prompt=prompt
)
```

---

## é™çº§ç­–ç•¥

### å¤±è´¥å¤„ç†æµç¨‹

```
MCP è°ƒç”¨å¤±è´¥
    â†“
é‡è¯• (æœ€å¤š 2 æ¬¡)
    â†“
ä»ç„¶å¤±è´¥ï¼Ÿ
    â†“
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ âš ï¸ MCP è°ƒç”¨å¤±è´¥                                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ æ¨¡å‹: {Codex/Gemini}                                       â•‘
â•‘ å·¥å…·: {tool_name}                                          â•‘
â•‘ é”™è¯¯: {error_message}                                      â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ ğŸ“‹ æ¢å¤é€‰é¡¹:                                               â•‘
â•‘   [1] ğŸ”„ é‡è¯• - å†æ¬¡å°è¯• MCP è°ƒç”¨                          â•‘
â•‘   [2] ğŸ”€ Claude æ¥ç®¡ - å…è®¸ Claude å®Œæˆæ­¤é˜¶æ®µ              â•‘
â•‘   [3] â­ï¸ è·³è¿‡ - è·³è¿‡æ­¤é˜¶æ®µ                                 â•‘
â•‘   [4] â›” ä¸­æ­¢ - ç»ˆæ­¢æ‰§è¡Œ                                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
è¯·é€‰æ‹© (1-4):
```

### é‡è¦çº¦æŸ

- **é™é»˜é™çº§ç¦æ­¢**ï¼šMCP å¤±è´¥åï¼Œ**ä¸å¾—**è‡ªåŠ¨ç”± Claude æ¥ç®¡
- **ç”¨æˆ·ç¡®è®¤å¿…éœ€**ï¼šå¿…é¡»è·å¾—ç”¨æˆ·æ˜ç¡®é€‰æ‹©åæ‰èƒ½ç»§ç»­
- **è®°å½•è¦æ±‚**ï¼šæ‰€æœ‰é™çº§å¿…é¡»åœ¨è¾“å‡ºå’Œæ—¥å¿—ä¸­æ˜ç¡®è®°å½•

---

## è°ƒç”¨éªŒè¯

### é˜¶æ®µå®Œæˆè¾“å‡º

**æˆåŠŸï¼š**
```
âœ… Phase {N} å®Œæˆ
â”œâ”€â”€ æ‰§è¡Œæ¨¡å‹: {å®é™…ä½¿ç”¨çš„æ¨¡å‹}
â”œâ”€â”€ MCP å·¥å…·: {tool_name æˆ– N/A}
â”œâ”€â”€ è€—æ—¶: {duration}
â””â”€â”€ è¾“å‡º: {output_file}
```

**é™çº§æ‰§è¡Œï¼š**
```
âš ï¸ Phase {N} å®Œæˆ (é™çº§æ‰§è¡Œ)
â”œâ”€â”€ åŸè®¡åˆ’æ¨¡å‹: {planned_model}
â”œâ”€â”€ å®é™…æ¨¡å‹: Claude (ç”¨æˆ·æˆæƒé™çº§)
â”œâ”€â”€ é™çº§åŸå› : {reason}
â””â”€â”€ è¾“å‡º: {output_file}
```

---

## çŠ¶æ€è¿½è¸ª

æ¯æ¬¡ MCP è°ƒç”¨è®°å½•åˆ°çŠ¶æ€æ–‡ä»¶ï¼š

```json
{
  "mcp_calls": [
    {
      "phase": 2,
      "model": "CODEX",
      "tool": "mcp__codex-cli__codex",
      "status": "success",
      "thread_id": "...",
      "timestamp": "...",
      "duration_ms": 5234
    }
  ],
  "fallbacks": [
    {
      "phase": 3,
      "original_model": "CODEX",
      "fallback_model": "CLAUDE",
      "reason": "MCP timeout",
      "user_approved": true,
      "timestamp": "..."
    }
  ]
}
```

---

## ä½¿ç”¨ç¤ºä¾‹

### è¿›å…¥ RALPH Phase 3

```markdown
1. æ£€æŸ¥åˆ†é…çŸ©é˜µ â†’ Phase 3 = CODEX, mandatory=true
2. è¾“å‡ºé˜¶æ®µæç¤ºï¼š
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ“ Phase 3/4: æ‰§è¡Œå­ä»»åŠ¡ | RALPH è·¯ç”±
   ğŸ¤– æ‰§è¡Œæ¨¡å‹: Codex (MCP å¼ºåˆ¶è°ƒç”¨)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ”§ MCP å·¥å…·: mcp__codex-cli__codex
   ğŸ“ è°ƒç”¨å‚æ•°: å®ç°ç”¨æˆ·è®¤è¯æ¨¡å—...
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

3. è°ƒç”¨ MCP:
   mcp__codex-cli__codex(prompt="...", sandbox="workspace-write")

4. éªŒè¯å¹¶ä¿å­˜ç»“æœ
5. è¾“å‡ºå®Œæˆæç¤ºï¼š
   âœ… Phase 3 å®Œæˆ
   â”œâ”€â”€ æ‰§è¡Œæ¨¡å‹: Codex
   â”œâ”€â”€ MCP å·¥å…·: mcp__codex-cli__codex
   â”œâ”€â”€ è€—æ—¶: 45s
   â””â”€â”€ è¾“å‡º: .skillpack/current/3_subtask_auth.md
```

---

## ä»»åŠ¡ç²’åº¦æ§åˆ¶ (v5.0 æ–°å¢)

### é—®é¢˜èƒŒæ™¯

MCP è°ƒç”¨å¤„ç†å¤æ‚ä»»åŠ¡æ—¶å¯èƒ½å‡ºç°ï¼š
- å“åº”æ—¶é—´è¿‡é•¿ï¼Œç”¨æˆ·è¯¯åˆ¤ä¸ºå¡ä½
- è¯·æ±‚è¿‡å¤§å¯¼è‡´è¶…æ—¶æˆ–ä¸­æ–­
- å•æ¬¡è°ƒç”¨å¤±è´¥å½±å“æ•´ä½“è¿›åº¦

### ç²’åº¦æ§åˆ¶åŸåˆ™

| æŒ‡æ ‡ | å»ºè®®é™åˆ¶ | åŸå›  |
|------|----------|------|
| Prompt é•¿åº¦ | < 5000 tokens | é¿å…è¾“å…¥è¿‡è½½ |
| å•æ–‡ä»¶ä¿®æ”¹ | < 500 è¡Œ | ä¾¿äºå®¡æŸ¥å’Œå›æ»š |
| å­ä»»åŠ¡æ•°é‡ | 3-5 ä¸ª | å¹³è¡¡æ•ˆç‡å’Œæ§åˆ¶ |
| é¢„è®¡æ‰§è¡Œæ—¶é—´ | < 2 åˆ†é’Ÿ | ç”¨æˆ·ä½“éªŒ |

### ä»»åŠ¡è‡ªåŠ¨æ‹†åˆ†

**æ‹†åˆ†è§¦å‘æ¡ä»¶ï¼š**
- ä»»åŠ¡æè¿° > 200 è¯
- æ¶‰åŠ > 3 ä¸ªæ–‡ä»¶
- åŒ…å«å¤šä¸ªç‹¬ç«‹åŠŸèƒ½ç‚¹

**æ‹†åˆ†ç¤ºä¾‹ï¼š**

```
åŸå§‹ä»»åŠ¡:
  "é‡å†™æ•´ä¸ª checkpoint.mdï¼Œæ·»åŠ åŸå­å†™å…¥ã€æ ¡éªŒå’Œã€å¤šç‰ˆæœ¬å¤‡ä»½"

æ‹†åˆ†å:
  1. "åœ¨ checkpoint.md ä¸­æ·»åŠ åŸå­å†™å…¥æœºåˆ¶"
  2. "åœ¨ checkpoint.md ä¸­æ·»åŠ  SHA-256 æ ¡éªŒå’ŒéªŒè¯"
  3. "åœ¨ checkpoint.md ä¸­æ›´æ–°å¤‡ä»½ç­–ç•¥å’Œ Schema"
```

### è¶…æ—¶é¢„è­¦æœºåˆ¶

å½“é¢„è®¡æ‰§è¡Œæ—¶é—´ > 60 ç§’æ—¶ï¼Œè¾“å‡ºè¿›åº¦æç¤ºï¼š

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â³ MCP è°ƒç”¨è¿›è¡Œä¸­
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
å·¥å…·: mcp__codex-cli__codex
é¢„è®¡æ—¶é—´: ~2-3 åˆ†é’Ÿ
çŠ¶æ€: æ­£åœ¨å¤„ç†...
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ’¡ æç¤º: å¤æ‚ä»»åŠ¡éœ€è¦æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…
   å¦‚éœ€ä¸­æ–­ï¼Œè¯·æŒ‰ Ctrl+C
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

---

## æ™ºèƒ½é™çº§ç­–ç•¥ (v5.0 æ–°å¢)

### ä»»åŠ¡ç±»å‹é™çº§çŸ©é˜µ

| ä»»åŠ¡ç±»å‹ | é¦–é€‰æ¨¡å‹ | å…è®¸é™çº§ | é™çº§æ¡ä»¶ |
|----------|----------|----------|----------|
| ä»£ç å®ç° | Codex | âŒ å¦ | ä¸å…è®¸é™çº§ |
| ä»£ç å®¡æŸ¥ | Codex | âš ï¸ æ¡ä»¶ | MCP å¤±è´¥ 2 æ¬¡åè¯¢é—® |
| æ–‡æ¡£æ›´æ–° | Codex | âœ… æ˜¯ | MCP å¤±è´¥ 1 æ¬¡åå¯é™çº§ |
| é…ç½®ä¿®æ”¹ | Claude | - | é»˜è®¤ Claude |
| æ¶æ„åˆ†æ | Gemini | âš ï¸ æ¡ä»¶ | MCP å¤±è´¥ 2 æ¬¡åè¯¢é—® |
| UI è®¾è®¡ | Gemini | âš ï¸ æ¡ä»¶ | MCP å¤±è´¥ 2 æ¬¡åè¯¢é—® |

### è‡ªåŠ¨é™çº§æ¡ä»¶

å¯¹äº**å…è®¸é™çº§**çš„ä»»åŠ¡ç±»å‹ï¼Œæ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶è‡ªåŠ¨æä¾›é™çº§é€‰é¡¹ï¼š

```yaml
auto_fallback_conditions:
  # æ–‡æ¡£ç±»ä»»åŠ¡
  documentation:
    file_types: [".md", ".txt", ".rst"]
    max_mcp_attempts: 1
    auto_suggest_fallback: true

  # é…ç½®ç±»ä»»åŠ¡
  configuration:
    file_types: [".json", ".yaml", ".toml", ".env"]
    max_mcp_attempts: 0  # ç›´æ¥ç”± Claude å¤„ç†

  # ä»£ç ç±»ä»»åŠ¡
  code:
    file_types: [".ts", ".js", ".py", ".go", ".rs"]
    max_mcp_attempts: 3
    auto_suggest_fallback: false
    require_user_confirmation: true
```

### é™çº§å†³ç­–æµç¨‹

```
MCP è°ƒç”¨å¤±è´¥
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: åˆ¤æ–­ä»»åŠ¡ç±»å‹                         â”‚
â”‚   documentation / configuration / code      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: æ£€æŸ¥é™çº§ç­–ç•¥                         â”‚
â”‚   å…è®¸é™çº§ï¼Ÿé‡è¯•æ¬¡æ•°ï¼Ÿ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€â”€ documentation + å¤±è´¥ 1 æ¬¡
    â”‚       â†“
    â”‚   "ğŸ“ æ–‡æ¡£æ›´æ–°ä»»åŠ¡ï¼Œå»ºè®®ç”± Claude ç»§ç»­"
    â”‚   [1] Claude æ¥ç®¡ (æ¨è)
    â”‚   [2] é‡è¯• MCP
    â”‚
    â”œâ”€â”€ code + å¤±è´¥ < 3 æ¬¡
    â”‚       â†“
    â”‚   è‡ªåŠ¨é‡è¯•ï¼Œä¸æ˜¾ç¤ºé™çº§é€‰é¡¹
    â”‚
    â””â”€â”€ code + å¤±è´¥ >= 3 æ¬¡
            â†“
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘ âš ï¸ MCP è°ƒç”¨å¤šæ¬¡å¤±è´¥                    â•‘
        â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
        â•‘ è¿™æ˜¯ä»£ç å®ç°ä»»åŠ¡ï¼Œé™çº§å¯èƒ½å½±å“è´¨é‡     â•‘
        â•‘                                        â•‘
        â•‘ [1] ç»§ç»­é‡è¯• MCP                       â•‘
        â•‘ [2] ğŸ–¥ï¸ CLI æ¨¡å¼ (æ¨è)                â•‘
        â•‘ [3] Claude æ¥ç®¡ (éœ€ç¡®è®¤)               â•‘
        â•‘ [4] è·³è¿‡æ­¤é˜¶æ®µ                         â•‘
        â•‘ [5] ä¸­æ­¢ä»»åŠ¡                           â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## CLI ç›´æ¥è°ƒç”¨ (v5.1 æ–°å¢)

### æ¦‚è¿°

å½“ MCP è°ƒç”¨å¤±è´¥æˆ–ç”¨æˆ·æŒ‡å®š `--cli` æ—¶ï¼Œå¯ä»¥ç»•è¿‡ MCPï¼Œç›´æ¥é€šè¿‡ Bash è°ƒç”¨ Codex/Gemini CLIã€‚

### ä¸‰å±‚é˜²å¾¡ç­–ç•¥

```
ç¬¬ 1 å±‚ï¼šä»»åŠ¡ç²’åº¦æ‹†åˆ†
    â”‚   å¤§ä»»åŠ¡è‡ªåŠ¨æ‹†åˆ†ä¸ºå°ä»»åŠ¡ï¼ˆ< 5000 tokensï¼‰
    â”‚   å‡å°‘å•æ¬¡è°ƒç”¨è¶…æ—¶æ¦‚ç‡
    â†“
ç¬¬ 2 å±‚ï¼šMCP é‡è¯• + è‡ªåŠ¨ CLI é™çº§
    â”‚   MCP å¤±è´¥æ—¶æŒ‡æ•°é€€é¿é‡è¯•
    â”‚   è¶…æ—¶åè‡ªåŠ¨åˆ‡æ¢åˆ° CLI ç›´æ¥è°ƒç”¨
    â†“
ç¬¬ 3 å±‚ï¼šè¯¢é—®ç”¨æˆ·é€‰æ‹©
    â”‚   CLI ä¹Ÿå¤±è´¥æ—¶è¯¢é—®ç”¨æˆ·
    â”‚   [1] é‡è¯•  [2] Claude æ¥ç®¡  [3] è·³è¿‡  [4] ä¸­æ­¢
```

### CLI è°ƒç”¨å‘½ä»¤

**Codex CLI**ï¼š
```bash
codex exec "<prompt>" -s workspace-write --json
```

**Gemini CLI**ï¼š
```bash
gemini "<prompt>" --model gemini-3-pro-preview
```

### è‡ªåŠ¨ CLI é™çº§æ¡ä»¶

å½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼Œè‡ªåŠ¨ä» MCP åˆ‡æ¢åˆ° CLIï¼š

```yaml
auto_cli_fallback:
  enabled: true
  trigger_conditions:
    - mcp_timeout_count >= 2
    - error_type == "ETIMEDOUT"
    - error_type == "ECONNREFUSED"
  applicable_routes:
    - DIRECT_CODE
    - PLANNED
    - RALPH
    - ARCHITECT
    - UI_FLOW
```

### CLI vs MCP å¯¹æ¯”

| æ–¹é¢ | MCP è°ƒç”¨ | CLI ç›´æ¥è°ƒç”¨ |
|------|----------|--------------|
| è°ƒç”¨æ–¹å¼ | `mcp__codex-cli__codex` | `codex exec` |
| ä¸Šä¸‹æ–‡æ³¨å…¥ | è‡ªåŠ¨ | æ‰‹åŠ¨æ”¶é›† |
| è¶…æ—¶é™åˆ¶ | å— MCP stdio é™åˆ¶ | å¯é…ç½®ï¼ˆé»˜è®¤ 300sï¼‰ |
| ç¨³å®šæ€§ | ä¾èµ– stdio é€šé“ | ç›´æ¥è¿›ç¨‹è°ƒç”¨ |
| æ¨èåœºæ™¯ | æ­£å¸¸æƒ…å†µ | MCP å¤±è´¥æ—¶ |

### CLI æ¨¡å¼é˜¶æ®µæç¤º

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ Phase {N}/{TOTAL}: {é˜¶æ®µåç§°} | {è·¯ç”±} è·¯ç”±
ğŸ–¥ï¸ æ‰§è¡Œæ¨¡å‹: {Codex/Gemini} (CLI ç›´æ¥è°ƒç”¨)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”§ CLI å‘½ä»¤: {command}
ğŸ“ è°ƒç”¨åŸå› : {MCP å¤±è´¥ / ç”¨æˆ·æŒ‡å®š --cli}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

---

## é…ç½®é€‰é¡¹

åœ¨ `.skillpackrc` ä¸­é…ç½®ï¼š

```json
{
  "mcp": {
    "timeout_seconds": 180,
    "max_retries": 3,
    "retry_delay_ms": 2000,
    "auto_chunk_large_tasks": true,
    "chunk_max_tokens": 5000,
    "show_progress_after_seconds": 60,
    "auto_fallback_to_cli": true,
    "fallback_strategy": {
      "documentation": "auto",
      "configuration": "claude_only",
      "code": "require_confirmation"
    }
  },
  "cli": {
    "codex_path": "codex",
    "gemini_path": "gemini",
    "prefer_cli_over_mcp": false,
    "cli_timeout_seconds": 300,
    "auto_context": true,
    "max_context_files": 10,
    "max_lines_per_file": 500
  }
}
```

### é…ç½®è¯´æ˜

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `mcp.auto_fallback_to_cli` | `true` | MCP è¶…æ—¶åè‡ªåŠ¨åˆ‡æ¢åˆ° CLI |
| `cli.codex_path` | `"codex"` | Codex CLI è·¯å¾„ |
| `cli.gemini_path` | `"gemini"` | Gemini CLI è·¯å¾„ |
| `cli.prefer_cli_over_mcp` | `false` | ä¼˜å…ˆä½¿ç”¨ CLIï¼ˆè·³è¿‡ MCPï¼‰ |
| `cli.cli_timeout_seconds` | `300` | CLI å‘½ä»¤è¶…æ—¶æ—¶é—´ |
| `cli.auto_context` | `true` | è‡ªåŠ¨æ”¶é›†ç›¸å…³æ–‡ä»¶ä¸Šä¸‹æ–‡ |
| `cli.max_context_files` | `10` | æœ€å¤§ä¸Šä¸‹æ–‡æ–‡ä»¶æ•° |
| `cli.max_lines_per_file` | `500` | æ¯ä¸ªæ–‡ä»¶æœ€å¤§è¡Œæ•° |

---

## å¹¶è¡Œ MCP è°ƒåº¦ (v5.2 æ–°å¢)

### æ¦‚è¿°

å½“ `parallel.enabled = true` æ—¶ï¼ŒMCP è°ƒåº¦æ¨¡å—æ”¯æŒåŒæ—¶å¯åŠ¨å¤šä¸ªåå°ä»»åŠ¡ï¼Œé€šè¿‡ `run_in_background: true` å‚æ•°å®ç°å¼‚æ­¥æ‰§è¡Œã€‚

### å¹¶è¡Œè°ƒåº¦æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Parallel Dispatcher                 â”‚
â”‚       (å¹¶è¡Œè°ƒåº¦å™¨ - Claude åè°ƒ)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼           â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚ Task  â”‚  â”‚ Task  â”‚  â”‚ Task  â”‚
â”‚ Codex â”‚  â”‚ Codex â”‚  â”‚Gemini â”‚
â”‚ bg=T  â”‚  â”‚ bg=T  â”‚  â”‚ bg=T  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚         â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         TaskOutput Collector                â”‚
â”‚    (ç»“æœæ”¶é›†å™¨ - è½®è¯¢æ£€æŸ¥çŠ¶æ€)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¹¶è¡Œè°ƒç”¨æ¨¡æ¿

#### å¹¶è¡Œå¯åŠ¨å¤šä¸ª Codex ä»»åŠ¡

```markdown
å½“éœ€è¦åŒæ—¶æ‰§è¡Œå¤šä¸ªä»£ç ä»»åŠ¡æ—¶ï¼Œåœ¨å•æ¡æ¶ˆæ¯ä¸­å¯åŠ¨å¤šä¸ª Taskï¼š

**è°ƒç”¨æ–¹å¼**ï¼šåœ¨ä¸€ä¸ªå“åº”ä¸­å‘é€å¤šä¸ª Task å·¥å…·è°ƒç”¨

Task 1:
- description: "å®ç°ç™»å½•æ¥å£"
- prompt: {codex_prompt_1}
- subagent_type: "Bash"
- run_in_background: true

Task 2:
- description: "å®ç°æ³¨å†Œæ¥å£"
- prompt: {codex_prompt_2}
- subagent_type: "Bash"
- run_in_background: true

Task 3:
- description: "å®ç°å¯†ç é‡ç½®"
- prompt: {codex_prompt_3}
- subagent_type: "Bash"
- run_in_background: true
```

#### Codex å¹¶è¡Œè°ƒç”¨ç¤ºä¾‹

```python
# å¹¶è¡Œæ‰§è¡Œ 3 ä¸ª Codex ä»»åŠ¡
tasks = [
    {
        "description": "å®ç°ç™»å½•æ¥å£",
        "prompt": f"""
        ä»»åŠ¡: å®ç°ç™»å½•æ¥å£

        ç›¸å…³æ–‡ä»¶:
        - src/auth/login.ts
        - src/models/user.ts

        è¦æ±‚:
        1. éªŒè¯ç”¨æˆ·å‡­æ®
        2. ç”Ÿæˆ JWT token
        3. å¤„ç†é”™è¯¯æƒ…å†µ
        """,
        "subagent_type": "Bash",
        "run_in_background": True
    },
    {
        "description": "å®ç°æ³¨å†Œæ¥å£",
        "prompt": "...",
        "subagent_type": "Bash",
        "run_in_background": True
    },
    {
        "description": "å®ç°å¯†ç é‡ç½®",
        "prompt": "...",
        "subagent_type": "Bash",
        "run_in_background": True
    }
]

# åŒæ—¶å¯åŠ¨æ‰€æœ‰ä»»åŠ¡
# Claude åœ¨å•æ¡æ¶ˆæ¯ä¸­å‘é€ 3 ä¸ª Task å·¥å…·è°ƒç”¨
```

#### è·¨æ¨¡å‹å¹¶è¡Œè°ƒç”¨

```markdown
åŒæ—¶å¯åŠ¨ Codex (åç«¯) å’Œ Gemini (å‰ç«¯) ä»»åŠ¡ï¼š

Task 1 (Codex - åç«¯):
- description: "å®ç° API æ¥å£"
- prompt: codex_backend_prompt
- subagent_type: "Bash"
- run_in_background: true

Task 2 (Gemini - å‰ç«¯):
- description: "è®¾è®¡ç™»å½•è¡¨å•"
- prompt: gemini_frontend_prompt
- subagent_type: "Bash"
- run_in_background: true
```

### ç»“æœæ”¶é›†

#### TaskOutput è½®è¯¢

```markdown
æ‰€æœ‰åå°ä»»åŠ¡å¯åŠ¨åï¼Œä½¿ç”¨ TaskOutput æ”¶é›†ç»“æœï¼š

**è½®è¯¢æµç¨‹**ï¼š
1. è®°å½•æ‰€æœ‰ task_id
2. å®šæœŸè°ƒç”¨ TaskOutput æ£€æŸ¥çŠ¶æ€
3. æ›´æ–°æ£€æŸ¥ç‚¹ä¸­çš„ä»»åŠ¡çŠ¶æ€
4. ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ

**TaskOutput è°ƒç”¨**ï¼š
- task_id: {ä»å¯åŠ¨å“åº”ä¸­è·å–}
- block: false (éé˜»å¡æ£€æŸ¥)
- timeout: 5000 (5ç§’è¶…æ—¶)
```

#### ç»“æœæ”¶é›†ç¤ºä¾‹

```python
def collect_parallel_results(task_ids: list, poll_interval: int = 5):
    """æ”¶é›†å¹¶è¡Œä»»åŠ¡ç»“æœ"""
    pending = set(task_ids)
    results = {}

    while pending:
        for task_id in list(pending):
            # éé˜»å¡æ£€æŸ¥
            output = TaskOutput(
                task_id=task_id,
                block=False,
                timeout=5000
            )

            if output.status == "completed":
                results[task_id] = output.result
                pending.remove(task_id)
                log_event("parallel_task_complete", task_id=task_id)

            elif output.status == "failed":
                results[task_id] = {"error": output.error}
                pending.remove(task_id)
                log_event("parallel_task_failed", task_id=task_id)

        if pending:
            # è¾“å‡ºè¿›åº¦
            print(f"â³ ç­‰å¾…ä¸­: {len(pending)}/{len(task_ids)} ä»»åŠ¡")
            sleep(poll_interval)

    return results
```

### å¹¶è¡Œè°ƒåº¦çŠ¶æ€æç¤º

#### å¯åŠ¨æ—¶

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš€ å¹¶è¡Œå¯åŠ¨ 3 ä¸ªä»»åŠ¡ | Wave 2/3
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ #1 [Codex] å®ç°ç™»å½•æ¥å£        â†’ task_id: bg-uuid-001  â”‚
â”‚ #2 [Codex] å®ç°æ³¨å†Œæ¥å£        â†’ task_id: bg-uuid-002  â”‚
â”‚ #3 [Gemini] è®¾è®¡ç™»å½•è¡¨å•       â†’ task_id: bg-uuid-003  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
è½®è¯¢é—´éš”: 5 ç§’
å•ä»»åŠ¡è¶…æ—¶: 300 ç§’
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

#### è½®è¯¢ä¸­

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â³ å¹¶è¡Œä»»åŠ¡æ‰§è¡Œä¸­ | å·²ç”¨æ—¶é—´: 45s
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[â—â—â—â—â—‹] #1 å®ç°ç™»å½•æ¥å£ (Codex)    - è¿è¡Œä¸­
[â—â—â—â—â—] #2 å®ç°æ³¨å†Œæ¥å£ (Codex)    - âœ… å®Œæˆ (38s)
[â—â—â—â—‹â—‹] #3 è®¾è®¡ç™»å½•è¡¨å• (Gemini)   - è¿è¡Œä¸­
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
è¿›åº¦: 1/3 å®Œæˆ | ä¸‹æ¬¡è½®è¯¢: 5s
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

#### å®Œæˆæ—¶

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… Wave 2 å®Œæˆ | 3/3 ä»»åŠ¡æˆåŠŸ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… #1 å®ç°ç™»å½•æ¥å£ (Codex)     - 52s                    â”‚
â”‚ âœ… #2 å®ç°æ³¨å†Œæ¥å£ (Codex)     - 38s                    â”‚
â”‚ âœ… #3 è®¾è®¡ç™»å½•è¡¨å• (Gemini)    - 65s                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è€—æ—¶: 65s (ä¸²è¡Œé¢„ä¼°: 155s, æé€Ÿ 2.4x)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

### å¹¶è¡Œå¤±è´¥å¤„ç†

#### éƒ¨åˆ†ä»»åŠ¡å¤±è´¥

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš ï¸ Wave 2 éƒ¨åˆ†å¤±è´¥ | 2/3 æˆåŠŸ, 1/3 å¤±è´¥
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… #1 å®ç°ç™»å½•æ¥å£ (Codex)     - 52s                    â”‚
â”‚ âŒ #2 å®ç°æ³¨å†Œæ¥å£ (Codex)     - å¤±è´¥: MCP è¶…æ—¶         â”‚
â”‚ âœ… #3 è®¾è®¡ç™»å½•è¡¨å• (Gemini)    - 65s                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ ğŸ“‹ é€‰æ‹©å¤„ç†æ–¹å¼:                                       â•‘
â•‘   [1] ğŸ”„ é‡è¯•å¤±è´¥ä»»åŠ¡                                  â•‘
â•‘   [2] ğŸ–¥ï¸ ä½¿ç”¨ CLI é‡è¯•                                 â•‘
â•‘   [3] â­ï¸ è·³è¿‡å¹¶ç»§ç»­ä¸‹ä¸€æ³¢æ¬¡                            â•‘
â•‘   [4] ğŸ“‰ é™çº§åˆ°ä¸²è¡Œæ¨¡å¼                                â•‘
â•‘   [5] â›” ä¸­æ­¢æ‰§è¡Œ                                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### å¹¶è¡Œè°ƒåº¦é…ç½®

```json
{
  "parallel": {
    "enabled": true,
    "max_concurrent_tasks": 3,
    "poll_interval_seconds": 5,
    "task_timeout_seconds": 300,
    "allow_cross_model_parallel": true,
    "fallback_to_serial_on_failure": true,
    "auto_dag_analysis": true,
    "wave_completion_strategy": "wait_all"
  }
}
```

### é…ç½®é¡¹è¯´æ˜

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `parallel.enabled` | `false` | æ˜¯å¦å¯ç”¨å¹¶è¡Œæ‰§è¡Œ |
| `parallel.max_concurrent_tasks` | `3` | å•æ³¢æ¬¡æœ€å¤§å¹¶å‘ä»»åŠ¡æ•° |
| `parallel.poll_interval_seconds` | `5` | TaskOutput è½®è¯¢é—´éš” |
| `parallel.task_timeout_seconds` | `300` | å•ä»»åŠ¡è¶…æ—¶æ—¶é—´ |
| `parallel.allow_cross_model_parallel` | `true` | å…è®¸ Codex + Gemini åŒæ—¶æ‰§è¡Œ |
| `parallel.fallback_to_serial_on_failure` | `true` | å¤±è´¥æ—¶è‡ªåŠ¨é™çº§åˆ°ä¸²è¡Œ |
| `parallel.auto_dag_analysis` | `true` | è‡ªåŠ¨åˆ†æä»»åŠ¡ä¾èµ–å…³ç³» |
| `parallel.wave_completion_strategy` | `wait_all` | æ³¢æ¬¡å®Œæˆç­–ç•¥ |

### çŠ¶æ€è¿½è¸ª

å¹¶è¡Œè°ƒåº¦çŠ¶æ€è®°å½•åˆ°æ£€æŸ¥ç‚¹ï¼š

```json
{
  "parallel_dispatch": {
    "enabled": true,
    "current_wave": 2,
    "active_tasks": {
      "bg-uuid-001": {
        "subtask": "subtask_3",
        "model": "codex",
        "started_at": "2026-01-19T10:30:00Z",
        "status": "running"
      },
      "bg-uuid-002": {
        "subtask": "subtask_4",
        "model": "gemini",
        "started_at": "2026-01-19T10:30:05Z",
        "status": "running"
      }
    },
    "completed_waves": [
      {
        "wave": 1,
        "tasks": ["subtask_1", "subtask_2"],
        "duration_ms": 45000
      }
    ]
  }
}
```

### æ—¥å¿—äº‹ä»¶

```json
{"ts":"...","level":"INFO","event":"parallel_dispatch_start","wave":2,"tasks":3}
{"ts":"...","level":"INFO","event":"parallel_task_launch","subtask":"subtask_3","task_id":"bg-uuid-001","model":"codex"}
{"ts":"...","level":"INFO","event":"parallel_poll","pending":2,"completed":1}
{"ts":"...","level":"INFO","event":"parallel_task_complete","subtask":"subtask_4","task_id":"bg-uuid-002","duration_ms":38000}
{"ts":"...","level":"WARN","event":"parallel_task_failed","subtask":"subtask_5","task_id":"bg-uuid-003","error":"timeout"}
{"ts":"...","level":"INFO","event":"parallel_dispatch_complete","wave":2,"success":2,"failed":1,"duration_ms":65000}
```
