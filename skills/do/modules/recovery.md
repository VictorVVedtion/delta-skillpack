# é”™è¯¯æ¢å¤æ¨¡å— (Error Recovery Module) v2.2

## æ¦‚è¿°

æ™ºèƒ½é”™è¯¯è¯Šæ–­å’Œæ¢å¤ç³»ç»Ÿï¼Œæ”¯æŒè‡ªåŠ¨ä¿®å¤å¸¸è§é—®é¢˜ï¼Œæä¾›å¤šç§æ¢å¤ç­–ç•¥é€‰é¡¹ã€‚v2.2 æ–°å¢ **å¹¶è¡Œä»»åŠ¡æ¢å¤ç­–ç•¥**ã€‚

---

## ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | ç‰¹æ€§ |
|------|------|
| **v2.2** | å¹¶è¡Œä»»åŠ¡æ¢å¤ã€æ³¢æ¬¡ä¸­æ–­æ¢å¤ã€è·¨æ¨¡å‹æ¢å¤ |
| v2.1 | CLI é™çº§æ¢å¤ç­–ç•¥ |
| v2.0 | MCP é”™è¯¯å¤„ç†ã€æŒ‡æ•°é€€é¿é‡è¯• |

---

## v2.2 æ–°ç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **å¹¶è¡Œä»»åŠ¡æ¢å¤** | æ£€æµ‹å¹¶æ¢å¤ä¸­æ–­çš„å¹¶è¡Œä»»åŠ¡ |
| **æ³¢æ¬¡ä¸­æ–­æ¢å¤** | ä»ä¸­æ–­çš„æ³¢æ¬¡ç»§ç»­æ‰§è¡Œ |
| **åå°ä»»åŠ¡çŠ¶æ€æ£€æµ‹** | é€šè¿‡ TaskOutput æ£€æµ‹ä»åœ¨è¿è¡Œçš„ä»»åŠ¡ |
| **éƒ¨åˆ†å®Œæˆå¤„ç†** | æ™ºèƒ½å¤„ç†æ³¢æ¬¡ä¸­éƒ¨åˆ†å®Œæˆçš„ä»»åŠ¡ |

## v2.1 ç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **CLI é™çº§é€‰é¡¹** | MCP å¤±è´¥æ—¶å¯é€‰æ‹©åˆ‡æ¢åˆ° CLI ç›´æ¥è°ƒç”¨ |
| **è‡ªåŠ¨ CLI é™çº§** | é…ç½® `mcp.auto_fallback_to_cli: true` åè‡ªåŠ¨é™çº§ |
| **ä¸‰å±‚é˜²å¾¡ç­–ç•¥** | ä»»åŠ¡ç²’åº¦æ‹†åˆ† â†’ MCP é‡è¯• â†’ CLI é™çº§ |

---

## é”™è¯¯åˆ†ç±»

### Level 1: å¯è‡ªåŠ¨æ¢å¤ (Transient)

| é”™è¯¯ç±»å‹ | ç—‡çŠ¶ | è‡ªåŠ¨æ¢å¤ç­–ç•¥ |
|----------|------|--------------|
| ç½‘ç»œè¶…æ—¶ | API è°ƒç”¨è¶…æ—¶ | æŒ‡æ•°é€€é¿é‡è¯•ï¼Œæœ€å¤š 3 æ¬¡ |
| ä¸´æ—¶æ–‡ä»¶é” | æ–‡ä»¶æ­£åœ¨ä½¿ç”¨ | ç­‰å¾… 2 ç§’é‡è¯•ï¼Œæœ€å¤š 5 æ¬¡ |
| è¯­æ³•é”™è¯¯ (ç®€å•) | ç¼ºå°‘åˆ†å·/æ‹¬å· | è‡ªåŠ¨æ£€æµ‹å¹¶ä¿®å¤ |
| æ ¼å¼é”™è¯¯ | JSON/YAML æ ¼å¼é—®é¢˜ | å°è¯•è‡ªåŠ¨æ ¼å¼åŒ– |
| MCP ä¸´æ—¶ä¸å¯ç”¨ | æœåŠ¡æš‚æ—¶æ— å“åº” | æŒ‡æ•°é€€é¿é‡è¯• |
| é€Ÿç‡é™åˆ¶ | Rate limit exceeded | ç­‰å¾… Retry-After åé‡è¯• |

### Level 2: éœ€ç”¨æˆ·ç¡®è®¤ (Recoverable)

| é”™è¯¯ç±»å‹ | ç—‡çŠ¶ | éœ€ç¡®è®¤å†…å®¹ |
|----------|------|------------|
| æ–‡ä»¶æƒé™ | æ— æ³•è¯»å†™æ–‡ä»¶ | æ˜¯å¦ä¿®æ”¹æƒé™ |
| ä¾èµ–ç¼ºå¤± | æ¨¡å—æœªæ‰¾åˆ° | æ˜¯å¦å®‰è£…ä¾èµ– |
| æµ‹è¯•å¤±è´¥ | æµ‹è¯•æœªé€šè¿‡ | æ˜¯å¦ç»§ç»­æˆ–ä¿®å¤ |
| å†²çªæ£€æµ‹ | Git å†²çª | å¦‚ä½•è§£å†³å†²çª |
| MCP è®¤è¯è¿‡æœŸ | Auth expired | æ˜¯å¦åˆ·æ–°è®¤è¯ |
| MCP é…é¢è¶…é™ | Quota exceeded | æ˜¯å¦ç­‰å¾…æˆ–å‡çº§ |
| æ¨¡å‹è¿‡è½½ | Model overloaded | æ˜¯å¦é€‰æ‹©å¤‡é€‰æ¨¡å‹ |

### Level 3: éœ€ç”¨æˆ·ä»‹å…¥ (Fatal)

| é”™è¯¯ç±»å‹ | ç—‡çŠ¶ | å¿…éœ€æ“ä½œ |
|----------|------|----------|
| è®¤è¯å¤±è´¥ | API å¯†é’¥æ— æ•ˆ | ç”¨æˆ·æä¾›å‡­è¯ |
| ä¸šåŠ¡é€»è¾‘ | éœ€æ±‚ä¸æ˜ç¡® | ç”¨æˆ·æ¾„æ¸…éœ€æ±‚ |
| ç³»ç»Ÿçº§ | ç£ç›˜æ»¡/å†…å­˜ä¸è¶³ | ç”¨æˆ·å¤„ç†ç³»ç»Ÿé—®é¢˜ |
| MCP è¯·æ±‚æ— æ•ˆ | Invalid request | æ£€æŸ¥ä»»åŠ¡æè¿° |
| å†…å®¹è¿‡æ»¤ | Content filtered | ä¿®æ”¹ä»»åŠ¡å†…å®¹ |
| æœªçŸ¥é”™è¯¯ | Unknown error | æŸ¥çœ‹å®Œæ•´é”™è¯¯æ—¥å¿— |

---

## MCP é”™è¯¯å¤„ç† (v2.0 æ–°å¢)

### MCP é”™è¯¯ä»£ç æ˜ å°„

| é”™è¯¯ç  | ç±»å‹ | çº§åˆ« | å¤„ç†ç­–ç•¥ |
|--------|------|------|----------|
| `ETIMEDOUT` | ç½‘ç»œè¶…æ—¶ | L1 | æŒ‡æ•°é€€é¿é‡è¯• |
| `ECONNREFUSED` | è¿æ¥æ‹’ç» | L1 | å»¶è¿Ÿé‡è¯• |
| `429` | é€Ÿç‡é™åˆ¶ | L1 | ç­‰å¾… Retry-After |
| `401` | è®¤è¯å¤±è´¥ | L2 | æç¤ºåˆ·æ–°è®¤è¯ |
| `403` | æƒé™ä¸è¶³ | L3 | ç”¨æˆ·æ£€æŸ¥æƒé™ |
| `400` | è¯·æ±‚æ— æ•ˆ | L3 | æ£€æŸ¥ä»»åŠ¡æè¿° |
| `500` | æœåŠ¡å™¨é”™è¯¯ | L1 | å»¶è¿Ÿé‡è¯• |
| `503` | æœåŠ¡ä¸å¯ç”¨ | L1 | å»¶è¿Ÿé‡è¯• |

### MCP è°ƒç”¨å¤±è´¥å¤„ç†æµç¨‹

```
MCP è°ƒç”¨å¤±è´¥
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: é”™è¯¯åˆ†ç±»                             â”‚
â”‚   è§£æé”™è¯¯ç å’Œæ¶ˆæ¯                           â”‚
â”‚   æ˜ å°„åˆ° L1/L2/L3 çº§åˆ«                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: æ ¹æ®çº§åˆ«å¤„ç†                         â”‚
â”‚   L1 â†’ è‡ªåŠ¨é‡è¯•                             â”‚
â”‚   L2 â†’ è¯¢é—®ç”¨æˆ·                             â”‚
â”‚   L3 â†’ æŠ¥å‘Šé”™è¯¯                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€â”€ L1: è‡ªåŠ¨é‡è¯•
    â”‚       â”‚
    â”‚       â–¼
    â”‚   é‡è¯•æ¬¡æ•° < æœ€å¤§æ¬¡æ•°?
    â”‚       â”œâ”€â”€ æ˜¯ â†’ ç­‰å¾…é€€é¿æ—¶é—´ â†’ é‡è¯•
    â”‚       â””â”€â”€ å¦ â†’ å‡çº§ä¸º L2
    â”‚
    â”œâ”€â”€ L2: è¯¢é—®ç”¨æˆ·
    â”‚       â”‚
    â”‚       â–¼
    â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    â”‚   âš ï¸ MCP è°ƒç”¨å¤±è´¥
    â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    â”‚   å·¥å…·: {tool_name}
    â”‚   é”™è¯¯: {error_message}
    â”‚   é‡è¯•: {retry_count}/{max_retries}
    â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚   ğŸ“‹ é€‰é¡¹:
    â”‚     [1] ğŸ”„ é‡è¯•
    â”‚     [2] ğŸ–¥ï¸ CLI æ¨¡å¼ (æ¨è)
    â”‚     [3] â¬‡ï¸ é™çº§åˆ° Claude
    â”‚     [4] â­ï¸ è·³è¿‡æ­¤é˜¶æ®µ
    â”‚     [5] â›” ä¸­æ­¢ä»»åŠ¡
    â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    â”‚
    â””â”€â”€ L3: æŠ¥å‘Šé”™è¯¯
            â”‚
            â–¼
        æ˜¾ç¤ºå®Œæ•´é”™è¯¯ä¿¡æ¯
        å»ºè®®ç”¨æˆ·æ“ä½œ
```

---

## é”™è¯¯è¯Šæ–­æµç¨‹

### Step 1: æ•è·é”™è¯¯

```
1. è®°å½•é”™è¯¯å‘ç”Ÿä½ç½®ï¼ˆé˜¶æ®µã€å­ä»»åŠ¡ã€æ­¥éª¤ï¼‰
2. è®°å½•é”™è¯¯æ¶ˆæ¯å’Œå †æ ˆ
3. è®°å½•å½“å‰ç¯å¢ƒçŠ¶æ€
4. ä¿å­˜é”™è¯¯å‰æ£€æŸ¥ç‚¹
```

### Step 2: åˆ†æé”™è¯¯

```
1. è§£æé”™è¯¯ç±»å‹
2. åŒ¹é…å·²çŸ¥é”™è¯¯æ¨¡å¼
3. è¯„ä¼°å½±å“èŒƒå›´
4. ç¡®å®šæ¢å¤éš¾åº¦
```

### Step 3: è¾“å‡ºè¯Šæ–­

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš ï¸ æ‰§è¡Œé”™è¯¯
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
é˜¶æ®µ: Phase {N} - {é˜¶æ®µåç§°}
ä½ç½®: {å…·ä½“ä½ç½®æè¿°}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
é”™è¯¯ç±»å‹: {é”™è¯¯åˆ†ç±»}
é”™è¯¯ä»£ç : {é”™è¯¯ç }ï¼ˆå¦‚æœ‰ï¼‰
é”™è¯¯æ¶ˆæ¯: {é”™è¯¯ä¿¡æ¯}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Š å½±å“åˆ†æ:
  å·²å®Œæˆ: {å·²å®Œæˆæ­¥éª¤}
  å—å½±å“: {å—å½±å“çš„æ–‡ä»¶/åŠŸèƒ½}
  å¯æ¢å¤: {æ˜¯/å¦}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ’¡ è¯Šæ–­å»ºè®®:
  {å…·ä½“çš„è¯Šæ–­ç»“è®ºå’Œå»ºè®®}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

---

## æ¢å¤é€‰é¡¹

### æ ‡å‡†æ¢å¤èœå•

```
ğŸ“‹ æ¢å¤é€‰é¡¹:

  [1] ğŸ”„ ç»§ç»­ - ä»å¤±è´¥ç‚¹ç»§ç»­æ‰§è¡Œ
      â””â”€â”€ è·³è¿‡å¤±è´¥æ“ä½œï¼Œç»§ç»­ä¸‹ä¸€æ­¥

  [2] ğŸ” é‡è¯• - é‡æ–°æ‰§è¡Œå½“å‰æ­¥éª¤
      â””â”€â”€ ä½¿ç”¨ç›¸åŒå‚æ•°é‡è¯•å½“å‰æ“ä½œ

  [3] âª å›æ»š - æ’¤é”€æœ¬æ¬¡æ‰€æœ‰å˜æ›´
      â””â”€â”€ æ¢å¤åˆ°ä»»åŠ¡å¼€å§‹å‰çš„çŠ¶æ€

  [4] â­ï¸ è·³è¿‡ - è·³è¿‡å½“å‰é˜¶æ®µ
      â””â”€â”€ æ ‡è®°å½“å‰é˜¶æ®µä¸ºè·³è¿‡ï¼Œç»§ç»­ä¸‹ä¸€é˜¶æ®µ

  [5] â›” ä¸­æ­¢ - ç»ˆæ­¢æ‰§è¡Œ
      â””â”€â”€ ä¿ç•™å·²å®Œæˆçš„å·¥ä½œï¼Œåœæ­¢æ‰§è¡Œ

è¯·é€‰æ‹© (1-5):
```

### é€‰é¡¹è¯¦æƒ…

#### [1] ç»§ç»­

- ä¿å­˜é”™è¯¯æ—¥å¿—
- æ ‡è®°å½“å‰æ­¥éª¤ä¸º"è·³è¿‡"
- ä»ä¸‹ä¸€æ­¥ç»§ç»­æ‰§è¡Œ
- **é€‚ç”¨**: éå…³é”®æ­¥éª¤å¤±è´¥

#### [2] é‡è¯•

- æ¸…é™¤é”™è¯¯çŠ¶æ€
- é‡æ–°æ‰§è¡Œå½“å‰æ­¥éª¤
- æœ€å¤šé‡è¯• 2 æ¬¡ï¼ˆè‡ªåŠ¨é‡è¯•ä¸è®¡å…¥ï¼‰
- **é€‚ç”¨**: ä¸´æ—¶æ€§é”™è¯¯

#### [3] å›æ»š

- è¯»å–æ£€æŸ¥ç‚¹å¤‡ä»½
- æ’¤é”€æ‰€æœ‰æ–‡ä»¶å˜æ›´
- æ¢å¤åˆ°ä»»åŠ¡å¼€å§‹çŠ¶æ€
- **é€‚ç”¨**: å‘ç°é‡å¤§é—®é¢˜

#### [4] è·³è¿‡

- æ ‡è®°å½“å‰é˜¶æ®µä¸º"è·³è¿‡"
- è®°å½•è·³è¿‡åŸå› 
- è¿›å…¥ä¸‹ä¸€é˜¶æ®µ
- **é€‚ç”¨**: å½“å‰é˜¶æ®µå¯å»¶åå¤„ç†

#### [5] ä¸­æ­¢

- ä¿å­˜å½“å‰æ£€æŸ¥ç‚¹
- è®°å½•ä¸­æ­¢åŸå› 
- è¾“å‡ºå®Œæˆæ‘˜è¦
- **é€‚ç”¨**: éœ€è¦ç”¨æˆ·ä»‹å…¥

---

## è‡ªåŠ¨æ¢å¤ç­–ç•¥

### æŒ‡æ•°é€€é¿é‡è¯•é…ç½® (v2.0)

```yaml
retry_policy:
  # é»˜è®¤é…ç½®
  max_attempts: 3
  backoff:
    initial_delay_ms: 1000    # é¦–æ¬¡é‡è¯•å»¶è¿Ÿ 1 ç§’
    multiplier: 2             # æ¯æ¬¡å»¶è¿Ÿç¿»å€
    max_delay_ms: 30000       # æœ€å¤§å»¶è¿Ÿ 30 ç§’
    jitter: true              # æ·»åŠ éšæœºæŠ–åŠ¨

  # æŒ‰é”™è¯¯ç±»å‹é…ç½®
  per_error_type:
    NETWORK_TIMEOUT:
      max_attempts: 5
      timeout_extension_percent: 50   # è¶…æ—¶åå»¶é•¿ 50%

    RATE_LIMIT:
      use_retry_after: true           # ä½¿ç”¨æœåŠ¡å™¨è¿”å›çš„ Retry-After
      fallback_delay_ms: 60000        # æ—  Retry-After æ—¶é»˜è®¤ 60 ç§’

    MODEL_OVERLOADED:
      max_attempts: 2
      suggest_fallback_model: true    # å»ºè®®ä½¿ç”¨å¤‡é€‰æ¨¡å‹

    MCP_ABORT:
      max_attempts: 1                 # ç”¨æˆ·ä¸­æ–­ä¸é‡è¯•
      prompt_user: true               # ç›´æ¥è¯¢é—®ç”¨æˆ·
```

### é‡è¯•åºåˆ—ç¤ºä¾‹

```
å°è¯• 1: ç«‹å³æ‰§è¡Œ
å¤±è´¥ â†’ ç­‰å¾… 1s (+ jitter)
å°è¯• 2: æ‰§è¡Œ
å¤±è´¥ â†’ ç­‰å¾… 2s (+ jitter)
å°è¯• 3: æ‰§è¡Œ
å¤±è´¥ â†’ ç­‰å¾… 4s (+ jitter)
å°è¯• 4: æ‰§è¡Œ
å¤±è´¥ â†’ å‡çº§ä¸º L2ï¼Œè¯¢é—®ç”¨æˆ·
```

### ç½‘ç»œé”™è¯¯

```python
retry_config = {
    "max_retries": 3,
    "base_delay": 5,  # ç§’
    "backoff": 2,     # æŒ‡æ•°é€€é¿
    "max_delay": 30
}

# é‡è¯•åºåˆ—: 5s, 10s, 20s
```

### è¯­æ³•é”™è¯¯è‡ªåŠ¨ä¿®å¤

**æ”¯æŒçš„ä¿®å¤**:
- ç¼ºå°‘åˆ†å· â†’ è‡ªåŠ¨æ·»åŠ 
- ç¼ºå°‘é—­åˆæ‹¬å· â†’ è‡ªåŠ¨æ·»åŠ 
- ç¼©è¿›é”™è¯¯ â†’ è‡ªåŠ¨ä¿®æ­£
- å°¾éšé€—å· â†’ è‡ªåŠ¨å¤„ç†

**ä¿®å¤æµç¨‹**:
```
1. è§£æé”™è¯¯ä¿¡æ¯å®šä½é—®é¢˜
2. åº”ç”¨ä¿®å¤
3. é‡æ–°éªŒè¯
4. å¦‚ä¿®å¤å¤±è´¥ï¼Œå›é€€å¹¶æŠ¥å‘Š
```

### æ–‡ä»¶é”ç­‰å¾…

```
max_wait: 10 ç§’
check_interval: 2 ç§’
retry_count: 5 æ¬¡
```

---

## æ™ºèƒ½è¯Šæ–­å»ºè®®

### é”™è¯¯æ¨¡å¼åŒ¹é…

| é”™è¯¯æ¨¡å¼ | è¯Šæ–­ | å»ºè®® |
|----------|------|------|
| `ENOENT` | æ–‡ä»¶ä¸å­˜åœ¨ | æ£€æŸ¥è·¯å¾„ï¼Œæˆ–åˆ›å»ºæ–‡ä»¶ |
| `EACCES` | æƒé™ä¸è¶³ | æ£€æŸ¥æ–‡ä»¶æƒé™ |
| `ENOSPC` | ç£ç›˜ç©ºé—´ä¸è¶³ | æ¸…ç†ç£ç›˜ç©ºé—´ |
| `MODULE_NOT_FOUND` | ä¾èµ–ç¼ºå¤± | è¿è¡Œ npm install |
| `SyntaxError` | è¯­æ³•é”™è¯¯ | æ£€æŸ¥ä»£ç è¯­æ³• |
| `TypeError` | ç±»å‹é”™è¯¯ | æ£€æŸ¥å˜é‡ç±»å‹ |
| `ETIMEDOUT` | ç½‘ç»œè¶…æ—¶ | æ£€æŸ¥ç½‘ç»œè¿æ¥ |
| `401/403` | è®¤è¯/æˆæƒå¤±è´¥ | æ£€æŸ¥å‡­è¯ |

### ä¸Šä¸‹æ–‡æ„ŸçŸ¥å»ºè®®

åŸºäºå½“å‰æ‰§è¡Œé˜¶æ®µæä¾›é’ˆå¯¹æ€§å»ºè®®ï¼š

**Phase 1 (åˆ†æ/è§„åˆ’)**:
- å»ºè®®é‡æ–°åˆ†æä»»åŠ¡æè¿°
- æ£€æŸ¥é¡¹ç›®ç»“æ„æ˜¯å¦æ­£ç¡®

**Phase 2 (å®ç°)**:
- æ£€æŸ¥ä¾èµ–æ˜¯å¦å®‰è£…
- éªŒè¯ API æ¥å£æ˜¯å¦å¯ç”¨

**Phase 3 (å®¡æŸ¥)**:
- è¿è¡Œæµ‹è¯•ç¡®è®¤åŠŸèƒ½
- æ£€æŸ¥ä»£ç é£æ ¼

---

## é”™è¯¯æ—¥å¿—

### æ—¥å¿—æ ¼å¼

ä½ç½®: `.skillpack/current/error.log`

```
================================================================================
[2024-01-18T10:30:45.123Z] ERROR
================================================================================
Phase: 2 - å®ç°
Step: 3 - åˆ›å»ºè®¤è¯æ¨¡å—
File: src/auth.ts

Type: SyntaxError
Message: Unexpected token '}'
Stack:
  at Parser.parse (parser.js:123)
  at compile (compiler.js:45)

Context:
  Line: 42
  Code: if (user.isValid) {

Recovery:
  Attempt: auto-fix
  Result: success
  Action: Added missing closing brace at line 58

================================================================================
```

### æ—¥å¿—çº§åˆ«

| çº§åˆ« | è¯´æ˜ | è®°å½•å†…å®¹ |
|------|------|----------|
| ERROR | æ‰§è¡Œé”™è¯¯ | å®Œæ•´é”™è¯¯ä¿¡æ¯ + ä¸Šä¸‹æ–‡ |
| WARN | è­¦å‘Š | æ½œåœ¨é—®é¢˜ |
| INFO | ä¿¡æ¯ | æ¢å¤æ“ä½œè®°å½• |
| DEBUG | è°ƒè¯• | è¯¦ç»†æ‰§è¡Œæ­¥éª¤ï¼ˆå¯é€‰ï¼‰ |

---

## å›æ»šæœºåˆ¶

### æ–‡ä»¶çº§å›æ»š

```
1. è¯»å–æ£€æŸ¥ç‚¹ä¸­çš„æ–‡ä»¶æ ¡éªŒå’Œ
2. æ¯”å¯¹å½“å‰æ–‡ä»¶
3. æ¢å¤ä¿®æ”¹çš„æ–‡ä»¶ï¼ˆä» Git æˆ–å¤‡ä»½ï¼‰
4. åˆ é™¤æ–°åˆ›å»ºçš„æ–‡ä»¶
5. éªŒè¯æ¢å¤å®Œæ•´æ€§
```

### Git é›†æˆ

å¦‚æœé¡¹ç›®æ˜¯ Git ä»“åº“ï¼š
```bash
# å›æ»šæœªæäº¤çš„å˜æ›´
git checkout -- <modified_files>

# åˆ é™¤æ–°æ–‡ä»¶
git clean -fd <new_files_directories>
```

### é Git é¡¹ç›®

1. åœ¨ä»»åŠ¡å¼€å§‹æ—¶å¤‡ä»½å°†ä¿®æ”¹çš„æ–‡ä»¶
2. å›æ»šæ—¶ä»å¤‡ä»½æ¢å¤
3. åˆ é™¤æ–°åˆ›å»ºçš„æ–‡ä»¶

---

## é…ç½®é€‰é¡¹

åœ¨ `.skillpackrc` ä¸­é…ç½®ï¼š

```json
{
  "recovery": {
    "auto_retry": true,
    "max_auto_retries": 3,
    "auto_fix_syntax": true,
    "log_level": "INFO",
    "backup_before_modify": true
  }
}
```

| é€‰é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `auto_retry` | true | å¯ç”¨è‡ªåŠ¨é‡è¯• |
| `max_auto_retries` | 3 | æœ€å¤§è‡ªåŠ¨é‡è¯•æ¬¡æ•° |
| `auto_fix_syntax` | true | è‡ªåŠ¨ä¿®å¤è¯­æ³•é”™è¯¯ |
| `log_level` | INFO | æ—¥å¿—çº§åˆ« |
| `backup_before_modify` | true | ä¿®æ”¹å‰å¤‡ä»½æ–‡ä»¶ |

---

## CLI é™çº§æ¢å¤ç­–ç•¥ (v2.1 æ–°å¢)

### ä¸‰å±‚é˜²å¾¡ç­–ç•¥

```
ç¬¬ 1 å±‚ï¼šä»»åŠ¡ç²’åº¦æ‹†åˆ†
    â”‚   å¤§ä»»åŠ¡è‡ªåŠ¨æ‹†åˆ†ä¸ºå°ä»»åŠ¡ï¼ˆ< 5000 tokensï¼‰
    â”‚   å‡å°‘å•æ¬¡è°ƒç”¨è¶…æ—¶æ¦‚ç‡
    â†“
ç¬¬ 2 å±‚ï¼šMCP é‡è¯• + è‡ªåŠ¨ CLI é™çº§
    â”‚   MCP å¤±è´¥æ—¶æŒ‡æ•°é€€é¿é‡è¯•
    â”‚   è¶…æ—¶åè‡ªåŠ¨åˆ‡æ¢åˆ° CLI ç›´æ¥è°ƒç”¨
    â†“
ç¬¬ 3 å±‚ï¼šè¯¢é—®ç”¨æˆ·é€‰æ‹©
    â”‚   CLI ä¹Ÿå¤±è´¥æ—¶è¯¢é—®ç”¨æˆ·
    â”‚   [1] é‡è¯•  [2] Claude æ¥ç®¡  [3] è·³è¿‡  [4] ä¸­æ­¢
```

### è‡ªåŠ¨ CLI é™çº§

å½“ `mcp.auto_fallback_to_cli: true` æ—¶ï¼Œæ»¡è¶³ä»¥ä¸‹æ¡ä»¶è‡ªåŠ¨åˆ‡æ¢ï¼š

| æ¡ä»¶ | è§¦å‘é˜ˆå€¼ |
|------|----------|
| MCP è¶…æ—¶æ¬¡æ•° | >= 2 |
| é”™è¯¯ç±»å‹ | `ETIMEDOUT`, `ECONNREFUSED` |

### CLI é™çº§æ‰§è¡Œæµç¨‹

```
MCP è°ƒç”¨å¤±è´¥ï¼ˆè¶…æ—¶ï¼‰
    â”‚
    â–¼
æ£€æŸ¥ auto_fallback_to_cli é…ç½®
    â”‚
    â”œâ”€â”€ true: è‡ªåŠ¨åˆ‡æ¢åˆ° CLI
    â”‚       â”‚
    â”‚       â–¼
    â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    â”‚   ğŸ–¥ï¸ è‡ªåŠ¨åˆ‡æ¢åˆ° CLI ç›´æ¥è°ƒç”¨
    â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    â”‚   åŸæ¨¡å¼: MCP è°ƒç”¨
    â”‚   æ–°æ¨¡å¼: CLI ç›´æ¥è°ƒç”¨ (Bash)
    â”‚   åŸå› : MCP è¶…æ—¶ {retry_count} æ¬¡
    â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚       â”‚
    â”‚       â–¼
    â”‚   æ‰§è¡Œ CLI å‘½ä»¤
    â”‚
    â””â”€â”€ false: è¯¢é—®ç”¨æˆ·
            â”‚
            â–¼
        æ˜¾ç¤ºæ¢å¤é€‰é¡¹èœå•
```

### CLI å‘½ä»¤æ¨¡æ¿

**Codex CLI**:
```bash
codex exec "<prompt>" -s workspace-write --json
```

**Gemini CLI**:
```bash
gemini "<prompt>" --model gemini-3-pro-preview
```

### CLI é™çº§æ—¥å¿—

```json
{"ts":"2026-01-19T10:00:00Z","level":"WARN","event":"cli_fallback","model":"codex","reason":"mcp_timeout","retry_count":2}
{"ts":"2026-01-19T10:00:01Z","level":"INFO","event":"cli_call","model":"codex","command":"codex exec ..."}
{"ts":"2026-01-19T10:02:00Z","level":"INFO","event":"cli_complete","model":"codex","duration_ms":119000}
```

### é…ç½®ç¤ºä¾‹

```json
{
  "mcp": {
    "timeout_seconds": 180,
    "max_retries": 3,
    "auto_fallback_to_cli": true
  },
  "cli": {
    "codex_path": "codex",
    "gemini_path": "gemini",
    "cli_timeout_seconds": 300
  }
}
```

---

## å¹¶è¡Œä»»åŠ¡æ¢å¤ç­–ç•¥ (v2.2 æ–°å¢)

### æ¦‚è¿°

å½“å¹¶è¡Œæ‰§è¡Œæ¨¡å¼ä¸­æ–­æ—¶ï¼ˆå¦‚ç”¨æˆ·ä¸­æ–­ã€ç½‘ç»œé—®é¢˜ã€ç³»ç»Ÿé‡å¯ï¼‰ï¼Œæ¢å¤æ¨¡å—èƒ½å¤Ÿæ™ºèƒ½æ£€æµ‹å’Œæ¢å¤ï¼š
- ä»åœ¨è¿è¡Œçš„åå°ä»»åŠ¡
- å·²å®Œæˆä½†æœªå¤„ç†çš„ä»»åŠ¡
- å¤±è´¥éœ€è¦é‡è¯•çš„ä»»åŠ¡

### å¹¶è¡Œä¸­æ–­æ£€æµ‹

```
æ¢å¤å¯åŠ¨
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: æ£€æµ‹æ‰§è¡Œæ¨¡å¼                         â”‚
â”‚   æ£€æŸ¥ checkpoint.parallel_execution.enabled â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€â”€ false: ä½¿ç”¨æ ‡å‡†æ¢å¤æµç¨‹
    â”‚
    â””â”€â”€ true: è¿›å…¥å¹¶è¡Œæ¢å¤æµç¨‹
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: è¯»å–æ´»è·ƒä»»åŠ¡åˆ—è¡¨                     â”‚
â”‚   checkpoint.subtasks.in_progress           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: é€ä¸ªæ£€æŸ¥ä»»åŠ¡çŠ¶æ€                     â”‚
â”‚   ä½¿ç”¨ TaskOutput æŸ¥è¯¢æ¯ä¸ª task_id          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä»»åŠ¡çŠ¶æ€æ£€æµ‹

```python
def detect_parallel_task_status(checkpoint: dict) -> dict:
    """æ£€æµ‹å¹¶è¡Œä»»åŠ¡çŠ¶æ€"""
    in_progress = checkpoint["subtasks"]["in_progress"]
    status_report = {
        "still_running": [],
        "completed": [],
        "failed": [],
        "unknown": []
    }

    for subtask_id, task_info in in_progress.items():
        task_id = task_info.get("task_id")

        if not task_id:
            status_report["unknown"].append(subtask_id)
            continue

        try:
            output = TaskOutput(
                task_id=task_id,
                block=False,
                timeout=5000
            )

            if output.status == "running":
                status_report["still_running"].append({
                    "subtask": subtask_id,
                    "task_id": task_id,
                    "model": task_info["model"]
                })
            elif output.status == "completed":
                status_report["completed"].append({
                    "subtask": subtask_id,
                    "task_id": task_id,
                    "result": output.result
                })
            else:
                status_report["failed"].append({
                    "subtask": subtask_id,
                    "task_id": task_id,
                    "error": output.error
                })

        except Exception as e:
            status_report["unknown"].append(subtask_id)

    return status_report
```

### å¹¶è¡Œæ¢å¤æç¤º

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”„ æ£€æµ‹åˆ°å¹¶è¡Œæ‰§è¡Œä¸­æ–­
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ä»»åŠ¡: {task_description}
è·¯ç”±: RALPH
æ‰§è¡Œæ¨¡å¼: PARALLEL
æ³¢æ¬¡è¿›åº¦: Wave 2/3

ğŸ“Š ä»»åŠ¡çŠ¶æ€æ£€æµ‹:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â³ ä»åœ¨è¿è¡Œ: 1 ä¸ªä»»åŠ¡                                   â”‚
â”‚    â””â”€â”€ subtask_3 (Codex) - task_id: bg-uuid-001        â”‚
â”‚                                                         â”‚
â”‚ âœ… å·²å®Œæˆ: 2 ä¸ªä»»åŠ¡                                     â”‚
â”‚    â”œâ”€â”€ subtask_1 (Codex)                               â”‚
â”‚    â””â”€â”€ subtask_2 (Codex)                               â”‚
â”‚                                                         â”‚
â”‚ âŒ å¤±è´¥: 1 ä¸ªä»»åŠ¡                                       â”‚
â”‚    â””â”€â”€ subtask_4 (Gemini) - é”™è¯¯: MCP è¶…æ—¶              â”‚
â”‚                                                         â”‚
â”‚ â“ æœªçŸ¥: 0 ä¸ªä»»åŠ¡                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ ğŸ“‹ æ¢å¤é€‰é¡¹:                                           â•‘
â•‘   [1] â–¶ï¸ ç»§ç»­ç­‰å¾…è¿è¡Œä¸­çš„ä»»åŠ¡ï¼Œé‡è¯•å¤±è´¥ä»»åŠ¡            â•‘
â•‘   [2] ğŸ”„ é‡æ–°å¯åŠ¨æ‰€æœ‰æœªå®Œæˆä»»åŠ¡                        â•‘
â•‘   [3] ğŸ“‰ é™çº§åˆ°ä¸²è¡Œæ¨¡å¼ç»§ç»­                            â•‘
â•‘   [4] ğŸ“ æŸ¥çœ‹è¯¦ç»†çŠ¶æ€                                  â•‘
â•‘   [5] â›” æ”¾å¼ƒå¹¶é‡æ–°å¼€å§‹                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
è¯·é€‰æ‹© (1-5):
```

### æ¢å¤ç­–ç•¥

#### ç­–ç•¥ 1: ç»§ç»­ç­‰å¾… + é‡è¯•å¤±è´¥

```
é€‰æ‹© [1] ç»§ç»­ç­‰å¾…è¿è¡Œä¸­çš„ä»»åŠ¡
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: æ¢å¤è½®è¯¢è¿è¡Œä¸­çš„ä»»åŠ¡                 â”‚
â”‚   ç»§ç»­ TaskOutput è½®è¯¢ bg-uuid-001          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: å¤„ç†å·²å®Œæˆä»»åŠ¡ç»“æœ                   â”‚
â”‚   åº”ç”¨ subtask_1, subtask_2 çš„è¾“å‡º          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: é‡è¯•å¤±è´¥ä»»åŠ¡                         â”‚
â”‚   é‡æ–°å¯åŠ¨ subtask_4                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: ç»§ç»­æ­£å¸¸æ‰§è¡Œæµç¨‹                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç­–ç•¥ 2: é‡æ–°å¯åŠ¨æ‰€æœ‰æœªå®Œæˆ

```
é€‰æ‹© [2] é‡æ–°å¯åŠ¨æ‰€æœ‰æœªå®Œæˆä»»åŠ¡
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: å–æ¶ˆä»åœ¨è¿è¡Œçš„ä»»åŠ¡                   â”‚
â”‚   (å¦‚æœå¯èƒ½) ç»ˆæ­¢ bg-uuid-001               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: å¤„ç†å·²å®Œæˆä»»åŠ¡ç»“æœ                   â”‚
â”‚   åº”ç”¨å·²å®Œæˆä»»åŠ¡çš„è¾“å‡º                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: é‡æ–°å¯åŠ¨å½“å‰æ³¢æ¬¡æ‰€æœ‰æœªå®Œæˆä»»åŠ¡       â”‚
â”‚   subtask_3, subtask_4 é‡æ–°å¹¶è¡Œå¯åŠ¨         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç­–ç•¥ 3: é™çº§åˆ°ä¸²è¡Œæ¨¡å¼

```
é€‰æ‹© [3] é™çº§åˆ°ä¸²è¡Œæ¨¡å¼
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: ç­‰å¾…è¿è¡Œä¸­ä»»åŠ¡å®Œæˆ                   â”‚
â”‚   æˆ–è®¾ç½®è¶…æ—¶åè·³è¿‡                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: è®¾ç½® parallel.enabled = false       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: ä¸²è¡Œæ‰§è¡Œå‰©ä½™ä»»åŠ¡                     â”‚
â”‚   subtask_3 â†’ subtask_4 â†’ subtask_5        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ³¢æ¬¡ä¸­æ–­æ¢å¤

å½“åœ¨ç‰¹å®šæ³¢æ¬¡ä¸­æ–­æ—¶ï¼Œæ¢å¤æ¨¡å—æ™ºèƒ½å¤„ç†ï¼š

```
Wave 2 ä¸­æ–­çŠ¶æ€:
  - subtask_3: å®Œæˆ âœ…
  - subtask_4: è¿è¡Œä¸­ â³
  - subtask_5: å¤±è´¥ âŒ

æ¢å¤ç­–ç•¥:
  1. ä¸é‡å¤æ‰§è¡Œ subtask_3
  2. ç­‰å¾… subtask_4 å®Œæˆæˆ–é‡å¯
  3. é‡è¯• subtask_5
  4. å®Œæˆ Wave 2 åç»§ç»­ Wave 3
```

### è·¨æ¨¡å‹æ¢å¤

å½“ä¸­æ–­æ¶‰åŠå¤šä¸ªæ¨¡å‹æ—¶ï¼š

```
ä¸­æ–­çŠ¶æ€:
  - Codex ä»»åŠ¡ (subtask_3): è¿è¡Œä¸­
  - Gemini ä»»åŠ¡ (subtask_4): å¤±è´¥

æ¢å¤æ—¶:
  1. åˆ†åˆ«æ£€æµ‹æ¯ä¸ªæ¨¡å‹çš„ä»»åŠ¡çŠ¶æ€
  2. Codex ä»»åŠ¡ç»§ç»­ç­‰å¾…
  3. Gemini ä»»åŠ¡å¯é€‰æ‹©:
     - ä½¿ç”¨ Gemini é‡è¯•
     - é™çº§åˆ° Codex
     - ä½¿ç”¨ CLI è°ƒç”¨
```

### å¹¶è¡Œæ¢å¤æ£€æŸ¥ç‚¹æ›´æ–°

æ¢å¤åæ›´æ–°æ£€æŸ¥ç‚¹ï¼š

```json
{
  "subtasks": {
    "completed": ["subtask_1", "subtask_2", "subtask_3"],
    "in_progress": {
      "subtask_4": {
        "task_id": "bg-uuid-new",
        "model": "gemini",
        "started_at": "2026-01-19T11:00:00Z",
        "status": "running",
        "retry_count": 1
      }
    },
    "pending": ["subtask_5"]
  },
  "parallel_execution": {
    "enabled": true,
    "current_wave": 2,
    "recovery_info": {
      "recovered_at": "2026-01-19T11:00:00Z",
      "recovery_strategy": "continue_and_retry",
      "tasks_restarted": ["subtask_4"]
    }
  }
}
```

### æ—¥å¿—äº‹ä»¶

```json
{"ts":"...","level":"INFO","event":"parallel_recovery_start","wave":2,"in_progress":2,"completed":2,"failed":1}
{"ts":"...","level":"INFO","event":"parallel_task_status_detected","subtask":"subtask_3","status":"still_running"}
{"ts":"...","level":"INFO","event":"parallel_task_result_applied","subtask":"subtask_1","status":"completed"}
{"ts":"...","level":"INFO","event":"parallel_task_retry","subtask":"subtask_4","retry_count":1}
{"ts":"...","level":"INFO","event":"parallel_recovery_complete","strategy":"continue_and_retry"}
```

### é…ç½®é€‰é¡¹

```json
{
  "parallel": {
    "enabled": true,
    "fallback_to_serial_on_failure": true,
    "recovery": {
      "auto_detect_running_tasks": true,
      "max_wait_for_running_tasks_seconds": 60,
      "auto_retry_failed_tasks": true,
      "max_retry_count": 3
    }
  }
}
```

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `recovery.auto_detect_running_tasks` | `true` | è‡ªåŠ¨æ£€æµ‹ä»åœ¨è¿è¡Œçš„ä»»åŠ¡ |
| `recovery.max_wait_for_running_tasks_seconds` | `60` | ç­‰å¾…è¿è¡Œä¸­ä»»åŠ¡çš„æœ€é•¿æ—¶é—´ |
| `recovery.auto_retry_failed_tasks` | `true` | è‡ªåŠ¨é‡è¯•å¤±è´¥çš„ä»»åŠ¡ |
| `recovery.max_retry_count` | `3` | å•ä»»åŠ¡æœ€å¤§é‡è¯•æ¬¡æ•° |
